<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A tool for membrane protein preparation, molecular dynamics simulation setting, run and analysis"><meta name=author content="Constanza González, Mauricio Bedoya"><link href=https://maurobedoya.github.io/gatewizard/api/preparation/ rel=canonical><link href=../ rel=prev><link href=../builder/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.0"><title>Preparation Module - GateWizard Documentation</title><link rel=stylesheet href=../../assets/stylesheets/main.618322db.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=green> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#preparation-module class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="GateWizard Documentation" class="md-header__button md-logo" aria-label="GateWizard Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> GateWizard Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Preparation Module </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=green aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent=green aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/maurobedoya/gatewizard title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> gatewizard </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../installation/ class=md-tabs__link> Installation </a> </li> <li class=md-tabs__item> <a href=../../user-guide/ class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../../analysis/ class=md-tabs__link> Analysis </a> </li> <li class=md-tabs__item> <a href=../../troubleshooting/ class=md-tabs__link> Troubleshooting </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../ class=md-tabs__link> API Reference </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="GateWizard Documentation" class="md-nav__button md-logo" aria-label="GateWizard Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> GateWizard Documentation </label> <div class=md-nav__source> <a href=https://github.com/maurobedoya/gatewizard title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> gatewizard </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/ class=md-nav__link> <span class=md-ellipsis> User Guide </span> </a> </li> <li class=md-nav__item> <a href=../../analysis/ class=md-nav__link> <span class=md-ellipsis> Analysis </span> </a> </li> <li class=md-nav__item> <a href=../../troubleshooting/ class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6 checked> <div class="md-nav__link md-nav__container"> <a href=../ class="md-nav__link "> <span class=md-ellipsis> API Reference </span> </a> <label class="md-nav__link " for=__nav_6 id=__nav_6_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=true> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> API Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Preparation Module </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Preparation Module </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#import class=md-nav__link> <span class=md-ellipsis> Import </span> </a> </li> <li class=md-nav__item> <a href=#class-propkaanalyzer class=md-nav__link> <span class=md-ellipsis> Class: PropkaAnalyzer </span> </a> <nav class=md-nav aria-label="Class: PropkaAnalyzer"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#constructor class=md-nav__link> <span class=md-ellipsis> Constructor </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#core-methods class=md-nav__link> <span class=md-ellipsis> Core Methods </span> </a> <nav class=md-nav aria-label="Core Methods"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#method-run_analysis class=md-nav__link> <span class=md-ellipsis> Method: run_analysis() </span> </a> </li> <li class=md-nav__item> <a href=#method-extract_summary class=md-nav__link> <span class=md-ellipsis> Method: extract_summary() </span> </a> </li> <li class=md-nav__item> <a href=#method-parse_summary class=md-nav__link> <span class=md-ellipsis> Method: parse_summary() </span> </a> </li> <li class=md-nav__item> <a href=#method-apply_protonation_states class=md-nav__link> <span class=md-ellipsis> Method: apply_protonation_states() </span> </a> </li> <li class=md-nav__item> <a href=#method-get_default_protonation_state class=md-nav__link> <span class=md-ellipsis> Method: get_default_protonation_state() </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#protonation-state-methods class=md-nav__link> <span class=md-ellipsis> Protonation State Methods </span> </a> <nav class=md-nav aria-label="Protonation State Methods"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#method-get_available_states class=md-nav__link> <span class=md-ellipsis> Method: get_available_states() </span> </a> </li> <li class=md-nav__item> <a href=#amber-compatible-residue-names class=md-nav__link> <span class=md-ellipsis> AMBER-Compatible Residue Names </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#disulfide-bond-methods class=md-nav__link> <span class=md-ellipsis> Disulfide Bond Methods </span> </a> <nav class=md-nav aria-label="Disulfide Bond Methods"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#method-detect_disulfide_bonds class=md-nav__link> <span class=md-ellipsis> Method: detect_disulfide_bonds() </span> </a> </li> <li class=md-nav__item> <a href=#method-apply_disulfide_bonds class=md-nav__link> <span class=md-ellipsis> Method: apply_disulfide_bonds() </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#utility-methods class=md-nav__link> <span class=md-ellipsis> Utility Methods </span> </a> <nav class=md-nav aria-label="Utility Methods"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#method-get_residue_statistics class=md-nav__link> <span class=md-ellipsis> Method: get_residue_statistics() </span> </a> </li> <li class=md-nav__item> <a href=#method-get_ph_titration_curve class=md-nav__link> <span class=md-ellipsis> Method: get_ph_titration_curve() </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#protein-capping class=md-nav__link> <span class=md-ellipsis> Protein Capping </span> </a> <nav class=md-nav aria-label="Protein Capping"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#class-proteincapper class=md-nav__link> <span class=md-ellipsis> Class: ProteinCapper </span> </a> </li> <li class=md-nav__item> <a href=#method-remove_hydrogens_and_cap class=md-nav__link> <span class=md-ellipsis> Method: remove_hydrogens_and_cap() </span> </a> </li> <li class=md-nav__item> <a href=#convenience-function-cap_protein class=md-nav__link> <span class=md-ellipsis> Convenience Function: cap_protein() </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#pdb4amber-integration class=md-nav__link> <span class=md-ellipsis> pdb4amber Integration </span> </a> <nav class=md-nav aria-label="pdb4amber Integration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#acenme-cap-hetatm-fix class=md-nav__link> <span class=md-ellipsis> ACE/NME Cap HETATM Fix </span> </a> </li> <li class=md-nav__item> <a href=#method-run_pdb4amber_with_cap_fix class=md-nav__link> <span class=md-ellipsis> Method: run_pdb4amber_with_cap_fix() </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#complete-workflow-examples class=md-nav__link> <span class=md-ellipsis> Complete Workflow Examples </span> </a> <nav class=md-nav aria-label="Complete Workflow Examples"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#advanced-workflow-with-protonation-and-disulfide-bonds class=md-nav__link> <span class=md-ellipsis> Advanced Workflow with Protonation and Disulfide Bonds </span> </a> </li> <li class=md-nav__item> <a href=#workflow-with-protein-capping class=md-nav__link> <span class=md-ellipsis> Workflow with Protein Capping </span> </a> </li> <li class=md-nav__item> <a href=#multiple-ph-variants class=md-nav__link> <span class=md-ellipsis> Multiple pH Variants </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#advanced-topics class=md-nav__link> <span class=md-ellipsis> Advanced Topics </span> </a> <nav class=md-nav aria-label="Advanced Topics"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#residue-mapping-after-capping class=md-nav__link> <span class=md-ellipsis> Residue Mapping After Capping </span> </a> </li> <li class=md-nav__item> <a href=#custom-protonation-states class=md-nav__link> <span class=md-ellipsis> Custom Protonation States </span> </a> </li> <li class=md-nav__item> <a href=#filtering-and-analysis class=md-nav__link> <span class=md-ellipsis> Filtering and Analysis </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#important-notes class=md-nav__link> <span class=md-ellipsis> Important Notes </span> </a> <nav class=md-nav aria-label="Important Notes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#output-directory-behavior class=md-nav__link> <span class=md-ellipsis> Output Directory Behavior </span> </a> </li> <li class=md-nav__item> <a href=#pdb-records-vs-residues class=md-nav__link> <span class=md-ellipsis> PDB Records vs Residues </span> </a> </li> <li class=md-nav__item> <a href=#dictionary-key-names class=md-nav__link> <span class=md-ellipsis> Dictionary Key Names </span> </a> </li> <li class=md-nav__item> <a href=#output-files class=md-nav__link> <span class=md-ellipsis> Output Files </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../builder/ class=md-nav__link> <span class=md-ellipsis> Builder Module </span> </a> </li> <li class=md-nav__item> <a href=../equilibration/ class=md-nav__link> <span class=md-ellipsis> Equilibration </span> </a> </li> <li class=md-nav__item> <a href=../analysis/ class=md-nav__link> <span class=md-ellipsis> Analysis </span> </a> </li> <li class=md-nav__item> <a href=../../QUICK_REFERENCE/ class=md-nav__link> <span class=md-ellipsis> Quick Reference </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#import class=md-nav__link> <span class=md-ellipsis> Import </span> </a> </li> <li class=md-nav__item> <a href=#class-propkaanalyzer class=md-nav__link> <span class=md-ellipsis> Class: PropkaAnalyzer </span> </a> <nav class=md-nav aria-label="Class: PropkaAnalyzer"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#constructor class=md-nav__link> <span class=md-ellipsis> Constructor </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#core-methods class=md-nav__link> <span class=md-ellipsis> Core Methods </span> </a> <nav class=md-nav aria-label="Core Methods"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#method-run_analysis class=md-nav__link> <span class=md-ellipsis> Method: run_analysis() </span> </a> </li> <li class=md-nav__item> <a href=#method-extract_summary class=md-nav__link> <span class=md-ellipsis> Method: extract_summary() </span> </a> </li> <li class=md-nav__item> <a href=#method-parse_summary class=md-nav__link> <span class=md-ellipsis> Method: parse_summary() </span> </a> </li> <li class=md-nav__item> <a href=#method-apply_protonation_states class=md-nav__link> <span class=md-ellipsis> Method: apply_protonation_states() </span> </a> </li> <li class=md-nav__item> <a href=#method-get_default_protonation_state class=md-nav__link> <span class=md-ellipsis> Method: get_default_protonation_state() </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#protonation-state-methods class=md-nav__link> <span class=md-ellipsis> Protonation State Methods </span> </a> <nav class=md-nav aria-label="Protonation State Methods"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#method-get_available_states class=md-nav__link> <span class=md-ellipsis> Method: get_available_states() </span> </a> </li> <li class=md-nav__item> <a href=#amber-compatible-residue-names class=md-nav__link> <span class=md-ellipsis> AMBER-Compatible Residue Names </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#disulfide-bond-methods class=md-nav__link> <span class=md-ellipsis> Disulfide Bond Methods </span> </a> <nav class=md-nav aria-label="Disulfide Bond Methods"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#method-detect_disulfide_bonds class=md-nav__link> <span class=md-ellipsis> Method: detect_disulfide_bonds() </span> </a> </li> <li class=md-nav__item> <a href=#method-apply_disulfide_bonds class=md-nav__link> <span class=md-ellipsis> Method: apply_disulfide_bonds() </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#utility-methods class=md-nav__link> <span class=md-ellipsis> Utility Methods </span> </a> <nav class=md-nav aria-label="Utility Methods"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#method-get_residue_statistics class=md-nav__link> <span class=md-ellipsis> Method: get_residue_statistics() </span> </a> </li> <li class=md-nav__item> <a href=#method-get_ph_titration_curve class=md-nav__link> <span class=md-ellipsis> Method: get_ph_titration_curve() </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#protein-capping class=md-nav__link> <span class=md-ellipsis> Protein Capping </span> </a> <nav class=md-nav aria-label="Protein Capping"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#class-proteincapper class=md-nav__link> <span class=md-ellipsis> Class: ProteinCapper </span> </a> </li> <li class=md-nav__item> <a href=#method-remove_hydrogens_and_cap class=md-nav__link> <span class=md-ellipsis> Method: remove_hydrogens_and_cap() </span> </a> </li> <li class=md-nav__item> <a href=#convenience-function-cap_protein class=md-nav__link> <span class=md-ellipsis> Convenience Function: cap_protein() </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#pdb4amber-integration class=md-nav__link> <span class=md-ellipsis> pdb4amber Integration </span> </a> <nav class=md-nav aria-label="pdb4amber Integration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#acenme-cap-hetatm-fix class=md-nav__link> <span class=md-ellipsis> ACE/NME Cap HETATM Fix </span> </a> </li> <li class=md-nav__item> <a href=#method-run_pdb4amber_with_cap_fix class=md-nav__link> <span class=md-ellipsis> Method: run_pdb4amber_with_cap_fix() </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#complete-workflow-examples class=md-nav__link> <span class=md-ellipsis> Complete Workflow Examples </span> </a> <nav class=md-nav aria-label="Complete Workflow Examples"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#advanced-workflow-with-protonation-and-disulfide-bonds class=md-nav__link> <span class=md-ellipsis> Advanced Workflow with Protonation and Disulfide Bonds </span> </a> </li> <li class=md-nav__item> <a href=#workflow-with-protein-capping class=md-nav__link> <span class=md-ellipsis> Workflow with Protein Capping </span> </a> </li> <li class=md-nav__item> <a href=#multiple-ph-variants class=md-nav__link> <span class=md-ellipsis> Multiple pH Variants </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#advanced-topics class=md-nav__link> <span class=md-ellipsis> Advanced Topics </span> </a> <nav class=md-nav aria-label="Advanced Topics"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#residue-mapping-after-capping class=md-nav__link> <span class=md-ellipsis> Residue Mapping After Capping </span> </a> </li> <li class=md-nav__item> <a href=#custom-protonation-states class=md-nav__link> <span class=md-ellipsis> Custom Protonation States </span> </a> </li> <li class=md-nav__item> <a href=#filtering-and-analysis class=md-nav__link> <span class=md-ellipsis> Filtering and Analysis </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#important-notes class=md-nav__link> <span class=md-ellipsis> Important Notes </span> </a> <nav class=md-nav aria-label="Important Notes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#output-directory-behavior class=md-nav__link> <span class=md-ellipsis> Output Directory Behavior </span> </a> </li> <li class=md-nav__item> <a href=#pdb-records-vs-residues class=md-nav__link> <span class=md-ellipsis> PDB Records vs Residues </span> </a> </li> <li class=md-nav__item> <a href=#dictionary-key-names class=md-nav__link> <span class=md-ellipsis> Dictionary Key Names </span> </a> </li> <li class=md-nav__item> <a href=#output-files class=md-nav__link> <span class=md-ellipsis> Output Files </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=preparation-module>Preparation Module<a class=headerlink href=#preparation-module title="Permanent link">&para;</a></h1> <p>Module for predicting pKa values and managing protonation states in protein structures. This module includes:</p> <ul> <li>pKa prediction and analysis</li> <li>Protonation state assignment based on pH</li> <li>Disulfide bond detection and application</li> <li>Protein capping with ACE/NME groups</li> <li>pH-dependent protein structure preparation</li> </ul> <h2 id=import>Import<a class=headerlink href=#import title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.utils.protein_capping</span><span class=w> </span><span class=kn>import</span> <span class=n>ProteinCapper</span>
</code></pre></div> <h2 id=class-propkaanalyzer>Class: PropkaAnalyzer<a class=headerlink href=#class-propkaanalyzer title="Permanent link">&para;</a></h2> <p>Main class for running Propka analysis and managing protein protonation states.</p> <h3 id=constructor>Constructor<a class=headerlink href=#constructor title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=n>PropkaAnalyzer</span><span class=p>(</span><span class=n>propka_version</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;3&quot;</span><span class=p>)</span>
</code></pre></div> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Parameter</th> <th>Type</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>propka_version</code></td> <td><code>str</code></td> <td><code>"3"</code></td> <td>Version of Propka to use</td> </tr> </tbody> </table> <p><strong>Returns:</strong> <code>PropkaAnalyzer</code> instance</p> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>(</span><span class=n>propka_version</span><span class=o>=</span><span class=s2>&quot;3&quot;</span><span class=p>)</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Using PROPKA version: </span><span class=si>{</span><span class=n>analyzer</span><span class=o>.</span><span class=n>propka_version</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div></p> <hr> <h2 id=core-methods>Core Methods<a class=headerlink href=#core-methods title="Permanent link">&para;</a></h2> <h3 id=method-run_analysis>Method: run_analysis()<a class=headerlink href=#method-run_analysis title="Permanent link">&para;</a></h3> <p>Run Propka analysis on a PDB file to predict pKa values.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>run_analysis</span><span class=p>(</span><span class=n>pdb_file</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>output_dir</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span>
</code></pre></div> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Parameter</th> <th>Type</th> <th>Required</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>pdb_file</code></td> <td><code>str</code></td> <td>Yes</td> <td>Path to input PDB file</td> </tr> <tr> <td><code>output_dir</code></td> <td><code>str</code></td> <td>No</td> <td>Directory for output files. If None, uses input file's directory</td> </tr> </tbody> </table> <p><strong>Returns:</strong> <code>str</code> - Path to generated <code>.pka</code> file</p> <p><strong>Raises:</strong></p> <ul> <li><code>FileNotFoundError</code> - If input PDB file doesn't exist</li> <li><code>PropkaError</code> - If Propka execution fails</li> </ul> <p><strong>Output Files:</strong></p> <ul> <li><code>{basename}.pka</code> - Full Propka output file</li> </ul> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=n>pka_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>run_analysis</span><span class=p>(</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>)</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=c1># Returns: &quot;protein.pka&quot;</span>
</code></pre></div></p> <hr> <h3 id=method-extract_summary>Method: extract_summary()<a class=headerlink href=#method-extract_summary title="Permanent link">&para;</a></h3> <p>Extract the summary section from a Propka output file.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=n>extract_summary</span><span class=p>(</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>    <span class=n>propka_file</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>    <span class=n>output_file</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>    <span class=n>output_dir</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span>
</code></pre></div> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Parameter</th> <th>Type</th> <th>Required</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>propka_file</code></td> <td><code>str</code></td> <td>Yes</td> <td>Path to <code>.pka</code> file from <code>run_analysis()</code></td> </tr> <tr> <td><code>output_file</code></td> <td><code>str</code></td> <td>No</td> <td>Custom name for output file</td> </tr> <tr> <td><code>output_dir</code></td> <td><code>str</code></td> <td>No</td> <td>Directory for output file</td> </tr> </tbody> </table> <p><strong>Returns:</strong> <code>str</code> - Path to summary file</p> <p><strong>Raises:</strong> - <code>PropkaError</code> - If summary section not found in <code>.pka</code> file</p> <p><strong>Output Files:</strong> - <code>{basename}_summary_of_prediction.txt</code> - Extracted summary section</p> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=c1># First run analysis to generate the .pka file</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=n>analyzer</span><span class=o>.</span><span class=n>run_analysis</span><span class=p>(</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>)</span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=c1># Then extract summary</span>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=n>summary_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>extract_summary</span><span class=p>(</span><span class=s2>&quot;protein.pka&quot;</span><span class=p>)</span>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=c1># Returns: &quot;protein_summary_of_prediction.txt&quot;</span>
</code></pre></div></p> <hr> <h3 id=method-parse_summary>Method: parse_summary()<a class=headerlink href=#method-parse_summary title="Permanent link">&para;</a></h3> <p>Parse summary file and extract residue information as structured data.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=n>parse_summary</span><span class=p>(</span><span class=n>summary_file</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
</code></pre></div> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Parameter</th> <th>Type</th> <th>Required</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>summary_file</code></td> <td><code>str</code></td> <td>No</td> <td>Path to summary file. If None, uses last extracted summary</td> </tr> </tbody> </table> <p><strong>Returns:</strong> <code>List[Dict[str, Any]]</code> - List of residue dictionaries</p> <p><strong>Dictionary Structure:</strong></p> <table> <thead> <tr> <th>Key</th> <th>Type</th> <th>Description</th> <th>Example</th> </tr> </thead> <tbody> <tr> <td><code>"residue"</code></td> <td><code>str</code></td> <td>Residue/ligand name</td> <td><code>"ASP"</code>, <code>"HIS"</code>, <code>"P5S"</code>, <code>"LPE"</code></td> </tr> <tr> <td><code>"res_id"</code></td> <td><code>int</code></td> <td>Residue number (0 for ligands)</td> <td><code>42</code>, <code>156</code>, <code>0</code></td> </tr> <tr> <td><code>"chain"</code></td> <td><code>str</code></td> <td>Chain identifier</td> <td><code>"A"</code>, <code>"B"</code></td> </tr> <tr> <td><code>"pka"</code></td> <td><code>float</code></td> <td>Predicted pKa value</td> <td><code>3.85</code>, <code>6.45</code>, <code>10.83</code></td> </tr> <tr> <td><code>"atom"</code></td> <td><code>str</code></td> <td>Atom name (for ligands only)</td> <td><code>""</code>, <code>"N"</code>, <code>"CAX"</code>, <code>"O15"</code></td> </tr> <tr> <td><code>"atom_type"</code></td> <td><code>str</code></td> <td>Atom type classification</td> <td><code>""</code>, <code>"N31"</code>, <code>"OCO"</code>, <code>"OP"</code></td> </tr> <tr> <td><code>"model_pka"</code></td> <td><code>float</code> or <code>None</code></td> <td>Model pKa value</td> <td><code>3.80</code>, <code>6.00</code>, <code>10.00</code></td> </tr> </tbody> </table> <p><strong>Understanding Protein vs. Ligand Entries:</strong></p> <p>PROPKA analyzes both <strong>protein residues</strong> and <strong>ligand molecules</strong> for ionizable groups:</p> <p><strong>For Protein Residues:</strong></p> <ul> <li><code>res_id</code>: Actual residue number (12, 52, 115, etc.)</li> <li><code>atom</code>: Empty string (protein residues are treated at residue level)</li> <li><code>atom_type</code>: Empty string</li> <li>Example: <code>ASP 52 A</code> means Aspartate at position 52 in chain A</li> </ul> <p><strong>For Ligand Atoms:</strong></p> <ul> <li><code>res_id</code>: Set to 0 (ligands don't have meaningful residue numbers)</li> <li><code>atom</code>: Specific atom name in the ligand (<code>N</code>, <code>CAX</code>, <code>O15</code>, etc.)</li> <li><code>atom_type</code>: Atom type classification (<code>N31</code>, <code>OCO</code>, <code>OP</code>, etc.)</li> <li>Example: <code>P5S N A</code> means atom N in ligand P5S in chain A</li> </ul> <p><strong>PROPKA Summary Format:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>       Group      pKa  model-pKa   ligand atom-type
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>   ASP  52 A     4.33       3.80                      ← Protein residue
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>   GLU  65 A     4.87       4.50                      ← Protein residue
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>   HIS  77 A     6.07       6.50                      ← Protein residue
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>   N+    8 A     7.66       8.00                      ← N-terminus
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>   P5S   N A    10.83      10.00                N31   ← Ligand atom
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>   LPE   N A     9.87      10.00                N31   ← Ligand atom
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>   Y01 CAX A     4.62       4.50                OCO   ← Ligand atom
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>   P5S O15 A     5.46       6.00                 OP   ← Ligand atom
</code></pre></div></p> <p><strong>Common Atom Type Classifications:</strong></p> <ul> <li><strong>N31</strong> - Tertiary amine nitrogen (sp³, 3 bonds)</li> <li><strong>N33</strong> - Quaternary nitrogen (sp³, 4 bonds, charged)</li> <li><strong>OCO</strong> - Carboxyl oxygen (in -COO⁻)</li> <li><strong>OP</strong> - Phosphate oxygen (in -PO₄²⁻)</li> <li><strong>O3</strong> - Hydroxyl oxygen (sp³)</li> <li><strong>S3</strong> - Thiol sulfur (sp³)</li> </ul> <p><strong>Raises:</strong></p> <ul> <li><code>FileNotFoundError</code> - If summary file doesn't exist</li> <li><code>PropkaError</code> - If no ionizable residues found</li> </ul> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=c1># First run analysis and extract summary to generate the summary file</span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=n>analyzer</span><span class=o>.</span><span class=n>run_analysis</span><span class=p>(</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>)</span>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=n>analyzer</span><span class=o>.</span><span class=n>extract_summary</span><span class=p>(</span><span class=s2>&quot;protein.pka&quot;</span><span class=p>)</span>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=c1># Now parse the summary file</span>
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=n>residues</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>parse_summary</span><span class=p>(</span><span class=s2>&quot;protein_summary_of_prediction.txt&quot;</span><span class=p>)</span>
<a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=nb>print</span><span class=p>(</span><span class=n>residues</span><span class=p>)</span>
<a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=c1># Returns: [</span>
<a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=c1>#     # Protein residues:</span>
<a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=c1>#     {&#39;residue&#39;: &#39;ASP&#39;, &#39;res_id&#39;: 52, &#39;chain&#39;: &#39;A&#39;, &#39;pka&#39;: 4.33, </span>
<a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=c1>#      &#39;atom&#39;: &#39;&#39;, &#39;atom_type&#39;: &#39;&#39;, &#39;model_pka&#39;: 3.8},</span>
<a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=c1>#     {&#39;residue&#39;: &#39;GLU&#39;, &#39;res_id&#39;: 65, &#39;chain&#39;: &#39;A&#39;, &#39;pka&#39;: 3.87, </span>
<a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=c1>#      &#39;atom&#39;: &#39;&#39;, &#39;atom_type&#39;: &#39;&#39;, &#39;model_pka&#39;: 4.5},</span>
<a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=c1>#     </span>
<a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=c1>#     # Ligand atoms:</span>
<a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a><span class=c1>#     {&#39;residue&#39;: &#39;P5S&#39;, &#39;res_id&#39;: 0, &#39;chain&#39;: &#39;A&#39;, &#39;pka&#39;: 10.83, </span>
<a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a><span class=c1>#      &#39;atom&#39;: &#39;N&#39;, &#39;atom_type&#39;: &#39;N31&#39;, &#39;model_pka&#39;: 10.0},</span>
<a id=__codelineno-9-22 name=__codelineno-9-22 href=#__codelineno-9-22></a><span class=c1>#     {&#39;residue&#39;: &#39;LPE&#39;, &#39;res_id&#39;: 0, &#39;chain&#39;: &#39;A&#39;, &#39;pka&#39;: 9.87, </span>
<a id=__codelineno-9-23 name=__codelineno-9-23 href=#__codelineno-9-23></a><span class=c1>#      &#39;atom&#39;: &#39;N&#39;, &#39;atom_type&#39;: &#39;N31&#39;, &#39;model_pka&#39;: 10.0},</span>
<a id=__codelineno-9-24 name=__codelineno-9-24 href=#__codelineno-9-24></a><span class=c1>#     {&#39;residue&#39;: &#39;Y01&#39;, &#39;res_id&#39;: 0, &#39;chain&#39;: &#39;A&#39;, &#39;pka&#39;: 4.62, </span>
<a id=__codelineno-9-25 name=__codelineno-9-25 href=#__codelineno-9-25></a><span class=c1>#      &#39;atom&#39;: &#39;CAX&#39;, &#39;atom_type&#39;: &#39;OCO&#39;, &#39;model_pka&#39;: 4.5},</span>
<a id=__codelineno-9-26 name=__codelineno-9-26 href=#__codelineno-9-26></a><span class=c1>#     {&#39;residue&#39;: &#39;P5S&#39;, &#39;res_id&#39;: 0, &#39;chain&#39;: &#39;A&#39;, &#39;pka&#39;: 5.46, </span>
<a id=__codelineno-9-27 name=__codelineno-9-27 href=#__codelineno-9-27></a><span class=c1>#      &#39;atom&#39;: &#39;O15&#39;, &#39;atom_type&#39;: &#39;OP&#39;, &#39;model_pka&#39;: 6.0},</span>
<a id=__codelineno-9-28 name=__codelineno-9-28 href=#__codelineno-9-28></a><span class=c1>#     ...</span>
<a id=__codelineno-9-29 name=__codelineno-9-29 href=#__codelineno-9-29></a><span class=c1># ]</span>
<a id=__codelineno-9-30 name=__codelineno-9-30 href=#__codelineno-9-30></a>
<a id=__codelineno-9-31 name=__codelineno-9-31 href=#__codelineno-9-31></a><span class=c1># Separate protein residues from ligand atoms</span>
<a id=__codelineno-9-32 name=__codelineno-9-32 href=#__codelineno-9-32></a><span class=n>protein_residues</span> <span class=o>=</span> <span class=p>[</span><span class=n>r</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>residues</span> <span class=k>if</span> <span class=n>r</span><span class=p>[</span><span class=s1>&#39;res_id&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>]</span>
<a id=__codelineno-9-33 name=__codelineno-9-33 href=#__codelineno-9-33></a><span class=n>ligand_atoms</span> <span class=o>=</span> <span class=p>[</span><span class=n>r</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>residues</span> <span class=k>if</span> <span class=n>r</span><span class=p>[</span><span class=s1>&#39;res_id&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>]</span>
<a id=__codelineno-9-34 name=__codelineno-9-34 href=#__codelineno-9-34></a>
<a id=__codelineno-9-35 name=__codelineno-9-35 href=#__codelineno-9-35></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Found </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>protein_residues</span><span class=p>)</span><span class=si>}</span><span class=s2> ionizable protein residues&quot;</span><span class=p>)</span>
<a id=__codelineno-9-36 name=__codelineno-9-36 href=#__codelineno-9-36></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Found </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>ligand_atoms</span><span class=p>)</span><span class=si>}</span><span class=s2> ionizable ligand atoms&quot;</span><span class=p>)</span>
<a id=__codelineno-9-37 name=__codelineno-9-37 href=#__codelineno-9-37></a>
<a id=__codelineno-9-38 name=__codelineno-9-38 href=#__codelineno-9-38></a><span class=c1># Analyze ligands</span>
<a id=__codelineno-9-39 name=__codelineno-9-39 href=#__codelineno-9-39></a><span class=k>for</span> <span class=n>lig</span> <span class=ow>in</span> <span class=n>ligand_atoms</span><span class=p>:</span>
<a id=__codelineno-9-40 name=__codelineno-9-40 href=#__codelineno-9-40></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Ligand </span><span class=si>{</span><span class=n>lig</span><span class=p>[</span><span class=s1>&#39;residue&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> atom </span><span class=si>{</span><span class=n>lig</span><span class=p>[</span><span class=s1>&#39;atom&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> (</span><span class=si>{</span><span class=n>lig</span><span class=p>[</span><span class=s1>&#39;atom_type&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>): &quot;</span>
<a id=__codelineno-9-41 name=__codelineno-9-41 href=#__codelineno-9-41></a>          <span class=sa>f</span><span class=s2>&quot;pKa = </span><span class=si>{</span><span class=n>lig</span><span class=p>[</span><span class=s1>&#39;pka&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-9-42 name=__codelineno-9-42 href=#__codelineno-9-42></a>
<a id=__codelineno-9-43 name=__codelineno-9-43 href=#__codelineno-9-43></a><span class=c1># Group by ligand type</span>
<a id=__codelineno-9-44 name=__codelineno-9-44 href=#__codelineno-9-44></a><span class=kn>from</span><span class=w> </span><span class=nn>collections</span><span class=w> </span><span class=kn>import</span> <span class=n>defaultdict</span>
<a id=__codelineno-9-45 name=__codelineno-9-45 href=#__codelineno-9-45></a><span class=n>ligands_by_type</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>list</span><span class=p>)</span>
<a id=__codelineno-9-46 name=__codelineno-9-46 href=#__codelineno-9-46></a><span class=k>for</span> <span class=n>lig</span> <span class=ow>in</span> <span class=n>ligand_atoms</span><span class=p>:</span>
<a id=__codelineno-9-47 name=__codelineno-9-47 href=#__codelineno-9-47></a>    <span class=n>ligands_by_type</span><span class=p>[</span><span class=n>lig</span><span class=p>[</span><span class=s1>&#39;residue&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>lig</span><span class=p>)</span>
<a id=__codelineno-9-48 name=__codelineno-9-48 href=#__codelineno-9-48></a>
<a id=__codelineno-9-49 name=__codelineno-9-49 href=#__codelineno-9-49></a><span class=k>for</span> <span class=n>ligand_name</span><span class=p>,</span> <span class=n>atoms</span> <span class=ow>in</span> <span class=n>ligands_by_type</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<a id=__codelineno-9-50 name=__codelineno-9-50 href=#__codelineno-9-50></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=se>\n</span><span class=si>{</span><span class=n>ligand_name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>atoms</span><span class=p>)</span><span class=si>}</span><span class=s2> ionizable atoms&quot;</span><span class=p>)</span>
<a id=__codelineno-9-51 name=__codelineno-9-51 href=#__codelineno-9-51></a>    <span class=k>for</span> <span class=n>atom</span> <span class=ow>in</span> <span class=n>atoms</span><span class=p>:</span>
<a id=__codelineno-9-52 name=__codelineno-9-52 href=#__codelineno-9-52></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  </span><span class=si>{</span><span class=n>atom</span><span class=p>[</span><span class=s1>&#39;atom&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>6s</span><span class=si>}</span><span class=s2> pKa=</span><span class=si>{</span><span class=n>atom</span><span class=p>[</span><span class=s1>&#39;pka&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>5.2f</span><span class=si>}</span><span class=s2> (</span><span class=si>{</span><span class=n>atom</span><span class=p>[</span><span class=s1>&#39;atom_type&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>)&quot;</span><span class=p>)</span>
</code></pre></div></p> <p><strong>Output:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>...
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>Found 272 ionizable protein residues
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>Found 22 ionizable ligand atoms
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>Ligand P5S atom N (N31): pKa = 10.83
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>Ligand LPE atom N (N31): pKa = 9.87
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>Ligand OJ0 atom N02 (N33): pKa = 8.82
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>Ligand P5S atom C (OCO): pKa = 4.16
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>Ligand Y01 atom CAX (OCO): pKa = 4.62
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>Ligand Y01 atom CAX (OCO): pKa = 4.56
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>Ligand Y01 atom CAX (OCO): pKa = 5.05
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>Ligand Y01 atom CAX (OCO): pKa = 4.52
<a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a>Ligand Y01 atom CAX (OCO): pKa = 4.68
<a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>Ligand Y01 atom CAX (OCO): pKa = 4.65
<a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a>Ligand P5S atom O15 (OP): pKa = 5.46
<a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>Ligand LPE atom O31 (OP): pKa = 5.15
<a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>Ligand PCW atom O1P (OP): pKa = 6.08
<a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a>Ligand LPE atom O31 (OP): pKa = 6.46
<a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a>Ligand PCW atom O1P (OP): pKa = 5.62
<a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a>Ligand PCW atom O1P (OP): pKa = 7.02
<a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a>Ligand LPE atom O32 (OP): pKa = 6.01
<a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a>Ligand LPE atom O31 (OP): pKa = 6.54
<a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a>Ligand LPE atom O32 (OP): pKa = 6.30
<a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a>Ligand LPE atom O32 (OP): pKa = 6.81
<a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a>Ligand PCW atom O1P (OP): pKa = 6.17
<a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a>Ligand PCW atom O1P (OP): pKa = 4.64
<a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a>
<a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a>P5S: 3 ionizable atoms
<a id=__codelineno-10-28 name=__codelineno-10-28 href=#__codelineno-10-28></a>  N      pKa=10.83 (N31)
<a id=__codelineno-10-29 name=__codelineno-10-29 href=#__codelineno-10-29></a>  C      pKa= 4.16 (OCO)
<a id=__codelineno-10-30 name=__codelineno-10-30 href=#__codelineno-10-30></a>  O15    pKa= 5.46 (OP)
<a id=__codelineno-10-31 name=__codelineno-10-31 href=#__codelineno-10-31></a>
<a id=__codelineno-10-32 name=__codelineno-10-32 href=#__codelineno-10-32></a>LPE: 7 ionizable atoms
<a id=__codelineno-10-33 name=__codelineno-10-33 href=#__codelineno-10-33></a>  N      pKa= 9.87 (N31)
<a id=__codelineno-10-34 name=__codelineno-10-34 href=#__codelineno-10-34></a>  O31    pKa= 5.15 (OP)
<a id=__codelineno-10-35 name=__codelineno-10-35 href=#__codelineno-10-35></a>  O31    pKa= 6.46 (OP)
<a id=__codelineno-10-36 name=__codelineno-10-36 href=#__codelineno-10-36></a>  O32    pKa= 6.01 (OP)
<a id=__codelineno-10-37 name=__codelineno-10-37 href=#__codelineno-10-37></a>  O31    pKa= 6.54 (OP)
<a id=__codelineno-10-38 name=__codelineno-10-38 href=#__codelineno-10-38></a>  O32    pKa= 6.30 (OP)
<a id=__codelineno-10-39 name=__codelineno-10-39 href=#__codelineno-10-39></a>  O32    pKa= 6.81 (OP)
<a id=__codelineno-10-40 name=__codelineno-10-40 href=#__codelineno-10-40></a>
<a id=__codelineno-10-41 name=__codelineno-10-41 href=#__codelineno-10-41></a>OJ0: 1 ionizable atoms
<a id=__codelineno-10-42 name=__codelineno-10-42 href=#__codelineno-10-42></a>  N02    pKa= 8.82 (N33)
<a id=__codelineno-10-43 name=__codelineno-10-43 href=#__codelineno-10-43></a>
<a id=__codelineno-10-44 name=__codelineno-10-44 href=#__codelineno-10-44></a>Y01: 6 ionizable atoms
<a id=__codelineno-10-45 name=__codelineno-10-45 href=#__codelineno-10-45></a>  CAX    pKa= 4.62 (OCO)
<a id=__codelineno-10-46 name=__codelineno-10-46 href=#__codelineno-10-46></a>  CAX    pKa= 4.56 (OCO)
<a id=__codelineno-10-47 name=__codelineno-10-47 href=#__codelineno-10-47></a>  CAX    pKa= 5.05 (OCO)
<a id=__codelineno-10-48 name=__codelineno-10-48 href=#__codelineno-10-48></a>  CAX    pKa= 4.52 (OCO)
<a id=__codelineno-10-49 name=__codelineno-10-49 href=#__codelineno-10-49></a>  CAX    pKa= 4.68 (OCO)
<a id=__codelineno-10-50 name=__codelineno-10-50 href=#__codelineno-10-50></a>  CAX    pKa= 4.65 (OCO)
<a id=__codelineno-10-51 name=__codelineno-10-51 href=#__codelineno-10-51></a>
<a id=__codelineno-10-52 name=__codelineno-10-52 href=#__codelineno-10-52></a>PCW: 5 ionizable atoms
<a id=__codelineno-10-53 name=__codelineno-10-53 href=#__codelineno-10-53></a>  O1P    pKa= 6.08 (OP)
<a id=__codelineno-10-54 name=__codelineno-10-54 href=#__codelineno-10-54></a>  O1P    pKa= 5.62 (OP)
<a id=__codelineno-10-55 name=__codelineno-10-55 href=#__codelineno-10-55></a>  O1P    pKa= 7.02 (OP)
<a id=__codelineno-10-56 name=__codelineno-10-56 href=#__codelineno-10-56></a>  O1P    pKa= 6.17 (OP)
<a id=__codelineno-10-57 name=__codelineno-10-57 href=#__codelineno-10-57></a>  O1P    pKa= 4.64 (OP)
</code></pre></div></p> <hr> <h3 id=method-apply_protonation_states>Method: apply_protonation_states()<a class=headerlink href=#method-apply_protonation_states title="Permanent link">&para;</a></h3> <p>Apply predicted protonation states to a PDB file based on pH and Propka results.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=n>apply_protonation_states</span><span class=p>(</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>    <span class=n>input_pdb</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>    <span class=n>output_pdb</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>    <span class=n>ph</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>    <span class=n>custom_states</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>    <span class=n>residues</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>]</span>
</code></pre></div> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Parameter</th> <th>Type</th> <th>Required</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>input_pdb</code></td> <td><code>str</code></td> <td>Yes</td> <td>Path to input PDB file</td> </tr> <tr> <td><code>output_pdb</code></td> <td><code>str</code></td> <td>Yes</td> <td>Path for output PDB file with modified residue names</td> </tr> <tr> <td><code>ph</code></td> <td><code>float</code></td> <td>Yes</td> <td>Target pH value for protonation state prediction</td> </tr> <tr> <td><code>custom_states</code></td> <td><code>Dict[str, str]</code></td> <td>No</td> <td>Custom state overrides (format: <code>{"ASP42": "ASH"}</code> or <code>{"ASP42_A": "ASH"}</code>)</td> </tr> <tr> <td><code>residues</code></td> <td><code>List[Dict]</code></td> <td>No</td> <td>Residue list. If None, uses last parsed results</td> </tr> </tbody> </table> <p><strong>Returns:</strong> <code>Dict[str, int]</code> - Statistics dictionary</p> <p><strong>Return Dictionary:</strong></p> <table> <thead> <tr> <th>Key</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>"residue_changes"</code></td> <td><code>int</code></td> <td>Number of unique residues modified</td> </tr> <tr> <td><code>"record_changes"</code></td> <td><code>int</code></td> <td>Total number of PDB records (atoms) modified</td> </tr> </tbody> </table> <p><strong>Raises:</strong></p> <ul> <li><code>FileNotFoundError</code> - If input PDB file doesn't exist</li> <li><code>PropkaError</code> - If no residue data available (need to run <code>parse_summary()</code> first)</li> </ul> <p><strong>Protonation State Logic:</strong></p> <p>The method automatically determines protonation states based on pKa vs pH:</p> <table> <thead> <tr> <th>Residue</th> <th>Condition</th> <th>State</th> <th>AMBER Code</th> </tr> </thead> <tbody> <tr> <td>ASP</td> <td>pH &lt; pKa</td> <td>Protonated</td> <td>ASH</td> </tr> <tr> <td>ASP</td> <td>pH ≥ pKa</td> <td>Deprotonated</td> <td>ASP</td> </tr> <tr> <td>GLU</td> <td>pH &lt; pKa</td> <td>Protonated</td> <td>GLH</td> </tr> <tr> <td>GLU</td> <td>pH ≥ pKa</td> <td>Deprotonated</td> <td>GLU</td> </tr> <tr> <td>HIS</td> <td>pH &lt; pKa</td> <td>Protonated</td> <td>HIP</td> </tr> <tr> <td>HIS</td> <td>pH ≥ pKa</td> <td>Neutral (ε)</td> <td>HIE</td> </tr> <tr> <td>LYS</td> <td>pH &lt; pKa</td> <td>Protonated</td> <td>LYS</td> </tr> <tr> <td>LYS</td> <td>pH ≥ pKa</td> <td>Neutral</td> <td>LYN</td> </tr> <tr> <td>CYS</td> <td>pH &lt; pKa</td> <td>Free thiol</td> <td>CYS</td> </tr> <tr> <td>CYS</td> <td>pH ≥ pKa</td> <td>Deprotonated</td> <td>CYM</td> </tr> </tbody> </table> <p><strong>Important Notes:</strong></p> <ul> <li>This method <strong>only modifies residue names</strong> in the PDB file (e.g., ASP → ASH, HIS → HIP)</li> <li>It does <strong>NOT</strong> add or remove hydrogen atoms</li> <li>For MD simulations, you may need additional preparation:</li> <li>Use <code>pdb4amber</code> or LEaP to add missing hydrogens</li> <li>Use system preparation tools to add solvent and parameterize</li> </ul> <p><strong>Custom States Format:</strong></p> <p>Custom states can be specified with or without chain identifiers:</p> <ul> <li><code>{"ASP12": "ASH"}</code> - Applies to all chains</li> <li><code>{"ASP12_A": "ASH"}</code> - Applies only to chain A</li> <li><code>{"HIS15": "HID"}</code> - Use delta-protonated histidine instead of epsilon</li> </ul> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=n>pka_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>run_analysis</span><span class=p>(</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>)</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=n>summary_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>extract_summary</span><span class=p>(</span><span class=n>pka_file</span><span class=p>)</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=n>residues</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>parse_summary</span><span class=p>(</span><span class=n>summary_file</span><span class=p>)</span>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=c1># Basic usage - automatic protonation at pH 7.4</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=n>stats</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>apply_protonation_states</span><span class=p>(</span>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a>    <span class=n>input_pdb</span><span class=o>=</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a>    <span class=n>output_pdb</span><span class=o>=</span><span class=s2>&quot;protein_ph7.4.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a>    <span class=n>ph</span><span class=o>=</span><span class=mf>7.4</span><span class=p>,</span>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a>    <span class=n>residues</span><span class=o>=</span><span class=n>residues</span>
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=p>)</span>
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Modified </span><span class=si>{</span><span class=n>stats</span><span class=p>[</span><span class=s1>&#39;residue_changes&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> residues (</span><span class=si>{</span><span class=n>stats</span><span class=p>[</span><span class=s1>&#39;record_changes&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> atoms)&quot;</span><span class=p>)</span>
<a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a>
<a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=c1># With custom states - override specific residues</span>
<a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a><span class=n>custom</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a>    <span class=s2>&quot;ASP12&quot;</span><span class=p>:</span> <span class=s2>&quot;ASH&quot;</span><span class=p>,</span>    <span class=c1># Want to protonate original ASP12</span>
<a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a>    <span class=s2>&quot;GLU13&quot;</span><span class=p>:</span> <span class=s2>&quot;GLH&quot;</span><span class=p>,</span>    <span class=c1># Want to protonate original GLU13</span>
<a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a>    <span class=s2>&quot;HIS15&quot;</span><span class=p>:</span> <span class=s2>&quot;HID&quot;</span>     <span class=c1># Want delta-protonated original HIS15</span>
<a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a><span class=p>}</span>
<a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a>
<a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a><span class=n>stats</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>apply_protonation_states</span><span class=p>(</span>
<a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a>    <span class=n>input_pdb</span><span class=o>=</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-12-26 name=__codelineno-12-26 href=#__codelineno-12-26></a>    <span class=n>output_pdb</span><span class=o>=</span><span class=s2>&quot;protein_custom.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-12-27 name=__codelineno-12-27 href=#__codelineno-12-27></a>    <span class=n>ph</span><span class=o>=</span><span class=mf>7.4</span><span class=p>,</span>
<a id=__codelineno-12-28 name=__codelineno-12-28 href=#__codelineno-12-28></a>    <span class=n>custom_states</span><span class=o>=</span><span class=n>custom</span><span class=p>,</span>
<a id=__codelineno-12-29 name=__codelineno-12-29 href=#__codelineno-12-29></a>    <span class=n>residues</span><span class=o>=</span><span class=n>residues</span>
<a id=__codelineno-12-30 name=__codelineno-12-30 href=#__codelineno-12-30></a><span class=p>)</span>
</code></pre></div></p> <hr> <h3 id=method-get_default_protonation_state>Method: get_default_protonation_state()<a class=headerlink href=#method-get_default_protonation_state title="Permanent link">&para;</a></h3> <p>Get the default protonation state for a residue at a given pH.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=n>get_default_protonation_state</span><span class=p>(</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>    <span class=n>residue</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>    <span class=n>ph</span><span class=p>:</span> <span class=nb>float</span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span>
</code></pre></div> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Parameter</th> <th>Type</th> <th>Required</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>residue</code></td> <td><code>Dict[str, Any]</code></td> <td>Yes</td> <td>Residue dictionary from <code>parse_summary()</code></td> </tr> <tr> <td><code>ph</code></td> <td><code>float</code></td> <td>Yes</td> <td>Target pH value</td> </tr> </tbody> </table> <p><strong>Returns:</strong> <code>str</code> - Three-letter AMBER residue code</p> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=n>pka_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>run_analysis</span><span class=p>(</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>)</span>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=n>summary_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>extract_summary</span><span class=p>(</span><span class=n>pka_file</span><span class=p>)</span>
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=n>residues</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>parse_summary</span><span class=p>(</span><span class=n>summary_file</span><span class=p>)</span>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=k>for</span> <span class=n>res</span> <span class=ow>in</span> <span class=n>residues</span><span class=p>:</span>
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a>    <span class=n>states</span> <span class=o>=</span> <span class=p>[</span><span class=n>analyzer</span><span class=o>.</span><span class=n>get_default_protonation_state</span><span class=p>(</span><span class=n>res</span><span class=p>,</span> <span class=n>ph</span><span class=o>=</span><span class=n>p</span><span class=p>)</span> <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=p>[</span><span class=mf>2.0</span><span class=p>,</span> <span class=mf>7.0</span><span class=p>,</span> <span class=mf>11.0</span><span class=p>]]</span>
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>res</span><span class=p>[</span><span class=s1>&#39;residue&#39;</span><span class=p>]</span><span class=si>}{</span><span class=n>res</span><span class=p>[</span><span class=s1>&#39;res_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> (pKa=</span><span class=si>{</span><span class=n>res</span><span class=p>[</span><span class=s1>&#39;pka&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>): &quot;</span>
<a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a>          <span class=sa>f</span><span class=s2>&quot;pH2=</span><span class=si>{</span><span class=n>states</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>, pH7=</span><span class=si>{</span><span class=n>states</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=s2>, pH11=</span><span class=si>{</span><span class=n>states</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div></p> <hr> <h2 id=protonation-state-methods>Protonation State Methods<a class=headerlink href=#protonation-state-methods title="Permanent link">&para;</a></h2> <h3 id=method-get_available_states>Method: get_available_states()<a class=headerlink href=#method-get_available_states title="Permanent link">&para;</a></h3> <p>Get available protonation states for a residue type.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=n>get_available_states</span><span class=p>(</span><span class=n>residue_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]</span>
</code></pre></div> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Parameter</th> <th>Type</th> <th>Required</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>residue_type</code></td> <td><code>str</code></td> <td>Yes</td> <td>Three-letter residue code (e.g., "ASP", "HIS")</td> </tr> </tbody> </table> <p><strong>Returns:</strong> <code>Dict[str, str]</code> - Dictionary of available states</p> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=n>his_states</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>get_available_states</span><span class=p>(</span><span class=s2>&quot;HIS&quot;</span><span class=p>)</span>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=nb>print</span><span class=p>(</span><span class=n>his_states</span><span class=p>)</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=c1># Output: {&#39;neutral_epsilon&#39;: &#39;HIE&#39;, &#39;neutral_delta&#39;: &#39;HID&#39;, &#39;protonated&#39;: &#39;HIP&#39;}</span>
</code></pre></div></p> <hr> <h3 id=amber-compatible-residue-names>AMBER-Compatible Residue Names<a class=headerlink href=#amber-compatible-residue-names title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Standard</th> <th>Protonated</th> <th>Deprotonated</th> <th>Notes</th> </tr> </thead> <tbody> <tr> <td><strong>ASP</strong></td> <td>ASH</td> <td>ASP</td> <td>Aspartic acid</td> </tr> <tr> <td><strong>GLU</strong></td> <td>GLH</td> <td>GLU</td> <td>Glutamic acid</td> </tr> <tr> <td><strong>HIS</strong></td> <td>HIP</td> <td>HIE/HID</td> <td>HIP=both N protonated, HIE=ε, HID=δ</td> </tr> <tr> <td><strong>LYS</strong></td> <td>LYS</td> <td>LYN</td> <td>Lysine</td> </tr> <tr> <td><strong>ARG</strong></td> <td>ARG</td> <td>-</td> <td>Arginine (always protonated in AMBER)</td> </tr> <tr> <td><strong>CYS</strong></td> <td>CYS</td> <td>CYM</td> <td>Cysteine (free thiol)</td> </tr> <tr> <td><strong>CYS</strong></td> <td>-</td> <td>CYX</td> <td>Cysteine in disulfide bond</td> </tr> <tr> <td><strong>TYR</strong></td> <td>TYR</td> <td>TYM</td> <td>Tyrosine</td> </tr> </tbody> </table> <hr> <h2 id=disulfide-bond-methods>Disulfide Bond Methods<a class=headerlink href=#disulfide-bond-methods title="Permanent link">&para;</a></h2> <h3 id=method-detect_disulfide_bonds>Method: detect_disulfide_bonds()<a class=headerlink href=#method-detect_disulfide_bonds title="Permanent link">&para;</a></h3> <p>Automatically detect potential disulfide bonds based on sulfur-sulfur distance.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=n>detect_disulfide_bonds</span><span class=p>(</span>
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>    <span class=n>pdb_file</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>    <span class=n>distance_threshold</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>2.5</span>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>],</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>]]]</span>
</code></pre></div> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Parameter</th> <th>Type</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>pdb_file</code></td> <td><code>str</code></td> <td>Required</td> <td>Path to PDB file</td> </tr> <tr> <td><code>distance_threshold</code></td> <td><code>float</code></td> <td><code>2.5</code></td> <td>Maximum S-S distance in Ångströms</td> </tr> </tbody> </table> <p><strong>Returns:</strong> List of bond pairs: <code>[((res_name, res_id), (res_name, res_id)), ...]</code></p> <p><strong>Algorithm:</strong> 1. Extracts all cysteine SG (sulfur gamma) atoms from PDB 2. Calculates pairwise distances between all SG atoms 3. Identifies pairs within the distance threshold 4. Returns list of bonded residue pairs</p> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=c1># Detect with default 2.5 Å threshold</span>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=n>bonds</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>detect_disulfide_bonds</span><span class=p>(</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>)</span>
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Found </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>bonds</span><span class=p>)</span><span class=si>}</span><span class=s2> disulfide bonds:&quot;</span><span class=p>)</span>
<a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a>
<a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=k>for</span> <span class=n>bond</span> <span class=ow>in</span> <span class=n>bonds</span><span class=p>:</span>
<a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a>    <span class=p>(</span><span class=n>res1_name</span><span class=p>,</span> <span class=n>res1_id</span><span class=p>),</span> <span class=p>(</span><span class=n>res2_name</span><span class=p>,</span> <span class=n>res2_id</span><span class=p>)</span> <span class=o>=</span> <span class=n>bond</span>
<a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  </span><span class=si>{</span><span class=n>res1_name</span><span class=si>}{</span><span class=n>res1_id</span><span class=si>}</span><span class=s2> ↔ </span><span class=si>{</span><span class=n>res2_name</span><span class=si>}{</span><span class=n>res2_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a><span class=c1># Output:</span>
<a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a><span class=c1># Found 1 disulfide bonds:</span>
<a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=c1>#   CYS18 ↔ CYS34</span>
<a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a>
<a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a><span class=c1># Use stricter threshold</span>
<a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a><span class=n>bonds_strict</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>detect_disulfide_bonds</span><span class=p>(</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>,</span> <span class=n>distance_threshold</span><span class=o>=</span><span class=mf>2.0</span><span class=p>)</span>
<a id=__codelineno-18-17 name=__codelineno-18-17 href=#__codelineno-18-17></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Strict (2.0 Å): </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>bonds_strict</span><span class=p>)</span><span class=si>}</span><span class=s2> bonds&quot;</span><span class=p>)</span>
<a id=__codelineno-18-18 name=__codelineno-18-18 href=#__codelineno-18-18></a>
<a id=__codelineno-18-19 name=__codelineno-18-19 href=#__codelineno-18-19></a><span class=c1># Output:</span>
<a id=__codelineno-18-20 name=__codelineno-18-20 href=#__codelineno-18-20></a><span class=c1># Strict (2.0 Å): 0 bonds</span>
</code></pre></div></p> <hr> <h3 id=method-apply_disulfide_bonds>Method: apply_disulfide_bonds()<a class=headerlink href=#method-apply_disulfide_bonds title="Permanent link">&para;</a></h3> <p>Apply disulfide bond assignments by renaming CYS → CYX for bonded cysteines.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=n>apply_disulfide_bonds</span><span class=p>(</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>    <span class=n>input_pdb</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>    <span class=n>output_pdb</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a>    <span class=n>disulfide_bonds</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>],</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>]]]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>    <span class=n>auto_detect</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span>
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span>
</code></pre></div> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Parameter</th> <th>Type</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>input_pdb</code></td> <td><code>str</code></td> <td>Required</td> <td>Input PDB file path</td> </tr> <tr> <td><code>output_pdb</code></td> <td><code>str</code></td> <td>Required</td> <td>Output PDB file path</td> </tr> <tr> <td><code>disulfide_bonds</code></td> <td><code>List[Tuple]</code></td> <td><code>None</code></td> <td>Pre-detected bonds (auto-detect if None)</td> </tr> <tr> <td><code>auto_detect</code></td> <td><code>bool</code></td> <td><code>True</code></td> <td>Auto-detect if bonds not provided</td> </tr> </tbody> </table> <p><strong>Returns:</strong> <code>int</code> - Number of disulfide bonds applied (NOT the number of atoms changed)</p> <p><strong>What it does:</strong> 1. Identifies cysteines involved in disulfide bonds 2. Changes residue name from CYS to CYX in all ATOM/HETATM records 3. Preserves all other PDB information (coordinates, chains, etc.) 4. Returns count of bonds (e.g., 1 bond = 2 cysteines = ~20 atom records changed)</p> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=c1># Auto-detect and apply</span>
<a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=n>num_bonds</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>apply_disulfide_bonds</span><span class=p>(</span>
<a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a>    <span class=n>input_pdb</span><span class=o>=</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a>    <span class=n>output_pdb</span><span class=o>=</span><span class=s2>&quot;protein_ss_auto.pdb&quot;</span>
<a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=p>)</span>
<a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Applied </span><span class=si>{</span><span class=n>num_bonds</span><span class=si>}</span><span class=s2> disulfide bonds&quot;</span><span class=p>)</span>
<a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a>
<a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=c1># Use pre-detected bonds with custom threshold</span>
<a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=n>bonds</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>detect_disulfide_bonds</span><span class=p>(</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>,</span> <span class=n>distance_threshold</span><span class=o>=</span><span class=mf>2.3</span><span class=p>)</span>
<a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=n>num_bonds</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>apply_disulfide_bonds</span><span class=p>(</span>
<a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a>    <span class=n>input_pdb</span><span class=o>=</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a>    <span class=n>output_pdb</span><span class=o>=</span><span class=s2>&quot;protein_ss_custom.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a>    <span class=n>disulfide_bonds</span><span class=o>=</span><span class=n>bonds</span><span class=p>,</span>
<a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a>    <span class=n>auto_detect</span><span class=o>=</span><span class=kc>False</span>
<a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a><span class=p>)</span>
</code></pre></div></p> <p><strong>Integration with Protonation Workflow:</strong></p> <p>Disulfide bonds should be applied <strong>after</strong> protonation states:</p> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=n>pka_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>run_analysis</span><span class=p>(</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>)</span>
<a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=n>summary_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>extract_summary</span><span class=p>(</span><span class=n>pka_file</span><span class=p>)</span>
<a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=n>residues</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>parse_summary</span><span class=p>(</span><span class=n>summary_file</span><span class=p>)</span>
<a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=c1># Step 1: Apply protonation states</span>
<a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=n>stats</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>apply_protonation_states</span><span class=p>(</span>
<a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a>    <span class=n>input_pdb</span><span class=o>=</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a>    <span class=n>output_pdb</span><span class=o>=</span><span class=s2>&quot;protein_ph7.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a>    <span class=n>ph</span><span class=o>=</span><span class=mf>7.4</span><span class=p>,</span>
<a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a>    <span class=n>residues</span><span class=o>=</span><span class=n>residues</span><span class=p>,</span>
<a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a><span class=p>)</span>
<a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a>
<a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a><span class=c1># Step 2: Apply disulfide bonds to protonated structure</span>
<a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a><span class=n>num_bonds</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>apply_disulfide_bonds</span><span class=p>(</span>
<a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a>    <span class=n>input_pdb</span><span class=o>=</span><span class=s2>&quot;protein_ph7.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a>    <span class=n>output_pdb</span><span class=o>=</span><span class=s2>&quot;protein_ph7_ss.pdb&quot;</span>
<a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a><span class=p>)</span>
</code></pre></div></p> <hr> <h2 id=utility-methods>Utility Methods<a class=headerlink href=#utility-methods title="Permanent link">&para;</a></h2> <h3 id=method-get_residue_statistics>Method: get_residue_statistics()<a class=headerlink href=#method-get_residue_statistics title="Permanent link">&para;</a></h3> <p>Get statistics about the protonable residues.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=n>get_residue_statistics</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>]</span>
</code></pre></div> <p><strong>Returns:</strong> <code>Dict[str, int]</code> - Dictionary with residue type counts</p> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=n>pka_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>run_analysis</span><span class=p>(</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>)</span>
<a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=n>summary_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>extract_summary</span><span class=p>(</span><span class=n>pka_file</span><span class=p>)</span>
<a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=n>residues</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>parse_summary</span><span class=p>(</span><span class=n>summary_file</span><span class=p>)</span>
<a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a>
<a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=n>stats</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>get_residue_statistics</span><span class=p>()</span>
<a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=k>for</span> <span class=n>res_type</span><span class=p>,</span> <span class=n>count</span> <span class=ow>in</span> <span class=n>stats</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>res_type</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>count</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a><span class=c1># Output:</span>
<a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=c1># ASP: 2</span>
<a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=c1># GLU: 2</span>
<a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a><span class=c1># HIS: 1</span>
<a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a><span class=c1># CYS: 3</span>
<a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a><span class=c1># TYR: 1</span>
<a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a><span class=c1># LYS: 1</span>
<a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a><span class=c1># ARG: 2</span>
<a id=__codelineno-23-19 name=__codelineno-23-19 href=#__codelineno-23-19></a><span class=c1># N+: 1</span>
</code></pre></div></p> <hr> <h3 id=method-get_ph_titration_curve>Method: get_ph_titration_curve()<a class=headerlink href=#method-get_ph_titration_curve title="Permanent link">&para;</a></h3> <p>Generate titration curves for all protonable residues.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=n>get_ph_titration_curve</span><span class=p>(</span>
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>    <span class=n>ph_range</span><span class=p>:</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>14</span><span class=p>),</span>
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>    <span class=n>ph_step</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.5</span>
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]]</span>
</code></pre></div> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Parameter</th> <th>Type</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>ph_range</code></td> <td><code>Tuple[float, float]</code></td> <td><code>(0, 14)</code></td> <td>pH range as (min, max)</td> </tr> <tr> <td><code>ph_step</code></td> <td><code>float</code></td> <td><code>0.5</code></td> <td>Step size for pH values</td> </tr> </tbody> </table> <p><strong>Returns:</strong> <code>Dict[str, List[Tuple[float, str]]]</code> - Mapping of residue IDs to (pH, state) tuples</p> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=n>pka_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>run_analysis</span><span class=p>(</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>)</span>
<a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=n>summary_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>extract_summary</span><span class=p>(</span><span class=n>pka_file</span><span class=p>)</span>
<a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=n>residues</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>parse_summary</span><span class=p>(</span><span class=n>summary_file</span><span class=p>)</span>
<a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a>
<a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=n>curves</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>get_ph_titration_curve</span><span class=p>(</span><span class=n>ph_range</span><span class=o>=</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mi>10</span><span class=p>),</span> <span class=n>ph_step</span><span class=o>=</span><span class=mf>1.0</span><span class=p>)</span>
<a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a>
<a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a><span class=k>for</span> <span class=n>residue_id</span><span class=p>,</span> <span class=n>curve</span> <span class=ow>in</span> <span class=n>curves</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=se>\n</span><span class=si>{</span><span class=n>residue_id</span><span class=si>}</span><span class=s2>:&quot;</span><span class=p>)</span>
<a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a>    <span class=k>for</span> <span class=n>ph</span><span class=p>,</span> <span class=n>state</span> <span class=ow>in</span> <span class=n>curve</span><span class=p>:</span>
<a id=__codelineno-25-13 name=__codelineno-25-13 href=#__codelineno-25-13></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  pH </span><span class=si>{</span><span class=n>ph</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>state</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div></p> <p><strong>Plotting Example:</strong></p> <p>You can visualize titration curves using matplotlib. For readability, it's best to plot only specific residues of interest:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=kn>import</span><span class=w> </span><span class=nn>matplotlib.pyplot</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>plt</span>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a>
<a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=n>pka_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>run_analysis</span><span class=p>(</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>)</span>
<a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=n>summary_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>extract_summary</span><span class=p>(</span><span class=n>pka_file</span><span class=p>)</span>
<a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=n>residues</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>parse_summary</span><span class=p>(</span><span class=n>summary_file</span><span class=p>)</span>
<a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a>
<a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=c1># Get titration curves</span>
<a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=n>curves</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>get_ph_titration_curve</span><span class=p>(</span><span class=n>ph_range</span><span class=o>=</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>14</span><span class=p>),</span> <span class=n>ph_step</span><span class=o>=</span><span class=mf>0.5</span><span class=p>)</span>
<a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a>
<a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=c1># State encoding for plotting (1 = protonated, 0 = deprotonated)</span>
<a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a><span class=n>state_map</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;ASH&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;ASP&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;GLH&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;GLU&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> 
<a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a>             <span class=s1>&#39;HIP&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;HIE&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;HID&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;LYS&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;LYN&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a>             <span class=s1>&#39;CYS&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;CYM&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;TYR&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;TYM&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;ARG&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>}</span>
<a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a>
<a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a><span class=c1># Option 1: Select specific residues by name</span>
<a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a><span class=n>selected_residues</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;ASP12&#39;</span><span class=p>,</span> <span class=s1>&#39;GLU13&#39;</span><span class=p>,</span> <span class=s1>&#39;LYS16&#39;</span><span class=p>]</span>
<a id=__codelineno-26-19 name=__codelineno-26-19 href=#__codelineno-26-19></a><span class=n>filtered_curves</span> <span class=o>=</span> <span class=p>{</span><span class=n>k</span><span class=p>:</span> <span class=n>v</span> <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>curves</span><span class=o>.</span><span class=n>items</span><span class=p>()</span> <span class=k>if</span> <span class=n>k</span> <span class=ow>in</span> <span class=n>selected_residues</span><span class=p>}</span>
<a id=__codelineno-26-20 name=__codelineno-26-20 href=#__codelineno-26-20></a>
<a id=__codelineno-26-21 name=__codelineno-26-21 href=#__codelineno-26-21></a><span class=c1># Option 2: Select by residue type (e.g., only histidines)</span>
<a id=__codelineno-26-22 name=__codelineno-26-22 href=#__codelineno-26-22></a><span class=c1># filtered_curves = {k: v for k, v in curves.items() if k.startswith(&#39;HIS&#39;)}</span>
<a id=__codelineno-26-23 name=__codelineno-26-23 href=#__codelineno-26-23></a>
<a id=__codelineno-26-24 name=__codelineno-26-24 href=#__codelineno-26-24></a><span class=c1># Option 3: Select residues with pKa near physiological pH (6-8)</span>
<a id=__codelineno-26-25 name=__codelineno-26-25 href=#__codelineno-26-25></a><span class=c1># pka_dict = {f&quot;{r[&#39;residue&#39;]}{r[&#39;res_id&#39;]}_{r[&#39;chain&#39;]}&quot;: r[&#39;pka&#39;] </span>
<a id=__codelineno-26-26 name=__codelineno-26-26 href=#__codelineno-26-26></a><span class=c1>#             for r in residues if r[&#39;res_id&#39;] &gt; 0}</span>
<a id=__codelineno-26-27 name=__codelineno-26-27 href=#__codelineno-26-27></a><span class=c1># filtered_curves = {k: v for k, v in curves.items() </span>
<a id=__codelineno-26-28 name=__codelineno-26-28 href=#__codelineno-26-28></a><span class=c1>#                    if k in pka_dict and 6 &lt;= pka_dict[k] &lt;= 8}</span>
<a id=__codelineno-26-29 name=__codelineno-26-29 href=#__codelineno-26-29></a>
<a id=__codelineno-26-30 name=__codelineno-26-30 href=#__codelineno-26-30></a><span class=c1># Plot selected curves</span>
<a id=__codelineno-26-31 name=__codelineno-26-31 href=#__codelineno-26-31></a><span class=n>fig</span><span class=p>,</span> <span class=n>ax</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>6</span><span class=p>))</span>
<a id=__codelineno-26-32 name=__codelineno-26-32 href=#__codelineno-26-32></a>
<a id=__codelineno-26-33 name=__codelineno-26-33 href=#__codelineno-26-33></a><span class=k>for</span> <span class=n>residue_id</span><span class=p>,</span> <span class=n>curve</span> <span class=ow>in</span> <span class=n>filtered_curves</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<a id=__codelineno-26-34 name=__codelineno-26-34 href=#__codelineno-26-34></a>    <span class=n>ph_values</span> <span class=o>=</span> <span class=p>[</span><span class=n>ph</span> <span class=k>for</span> <span class=n>ph</span><span class=p>,</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>curve</span><span class=p>]</span>
<a id=__codelineno-26-35 name=__codelineno-26-35 href=#__codelineno-26-35></a>    <span class=n>protonation</span> <span class=o>=</span> <span class=p>[</span><span class=n>state_map</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>state</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>)</span> <span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>state</span> <span class=ow>in</span> <span class=n>curve</span><span class=p>]</span>
<a id=__codelineno-26-36 name=__codelineno-26-36 href=#__codelineno-26-36></a>    <span class=n>ax</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>ph_values</span><span class=p>,</span> <span class=n>protonation</span><span class=p>,</span> <span class=n>marker</span><span class=o>=</span><span class=s1>&#39;o&#39;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=n>residue_id</span><span class=p>,</span> 
<a id=__codelineno-26-37 name=__codelineno-26-37 href=#__codelineno-26-37></a>            <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>markersize</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.8</span><span class=p>)</span>
<a id=__codelineno-26-38 name=__codelineno-26-38 href=#__codelineno-26-38></a>
<a id=__codelineno-26-39 name=__codelineno-26-39 href=#__codelineno-26-39></a><span class=n>ax</span><span class=o>.</span><span class=n>axvline</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=mf>7.4</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;gray&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mf>1.5</span><span class=p>,</span> 
<a id=__codelineno-26-40 name=__codelineno-26-40 href=#__codelineno-26-40></a>           <span class=n>alpha</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;pH 7.4 (physiological)&#39;</span><span class=p>)</span>
<a id=__codelineno-26-41 name=__codelineno-26-41 href=#__codelineno-26-41></a><span class=n>ax</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s1>&#39;pH&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>12</span><span class=p>)</span>
<a id=__codelineno-26-42 name=__codelineno-26-42 href=#__codelineno-26-42></a><span class=n>ax</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s1>&#39;Protonation State (1=protonated, 0=deprotonated)&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>12</span><span class=p>)</span>
<a id=__codelineno-26-43 name=__codelineno-26-43 href=#__codelineno-26-43></a><span class=n>ax</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Protein Titration Curves&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>14</span><span class=p>)</span>
<a id=__codelineno-26-44 name=__codelineno-26-44 href=#__codelineno-26-44></a><span class=n>ax</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>(</span><span class=o>-</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>1.1</span><span class=p>)</span>
<a id=__codelineno-26-45 name=__codelineno-26-45 href=#__codelineno-26-45></a><span class=n>ax</span><span class=o>.</span><span class=n>grid</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.3</span><span class=p>)</span>
<a id=__codelineno-26-46 name=__codelineno-26-46 href=#__codelineno-26-46></a><span class=n>ax</span><span class=o>.</span><span class=n>legend</span><span class=p>(</span><span class=n>fontsize</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
<a id=__codelineno-26-47 name=__codelineno-26-47 href=#__codelineno-26-47></a><span class=n>plt</span><span class=o>.</span><span class=n>tight_layout</span><span class=p>()</span>
<a id=__codelineno-26-48 name=__codelineno-26-48 href=#__codelineno-26-48></a><span class=n>plt</span><span class=o>.</span><span class=n>savefig</span><span class=p>(</span><span class=s1>&#39;propka_titration_curves.png&#39;</span><span class=p>,</span> <span class=n>dpi</span><span class=o>=</span><span class=mi>300</span><span class=p>,</span> <span class=n>bbox_inches</span><span class=o>=</span><span class=s1>&#39;tight&#39;</span><span class=p>)</span>
<a id=__codelineno-26-49 name=__codelineno-26-49 href=#__codelineno-26-49></a><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
<a id=__codelineno-26-50 name=__codelineno-26-50 href=#__codelineno-26-50></a>
<a id=__codelineno-26-51 name=__codelineno-26-51 href=#__codelineno-26-51></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Plotted </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>filtered_curves</span><span class=p>)</span><span class=si>}</span><span class=s2> out of </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>curves</span><span class=p>)</span><span class=si>}</span><span class=s2> total residues&quot;</span><span class=p>)</span>
<a id=__codelineno-26-52 name=__codelineno-26-52 href=#__codelineno-26-52></a><span class=c1># Output</span>
<a id=__codelineno-26-53 name=__codelineno-26-53 href=#__codelineno-26-53></a><span class=c1># Plotted 3 out of 13 total residues</span>
</code></pre></div> <p><strong>Example Output:</strong></p> <p><img alt="Titration Curves" src=../../images/api/propka_titration_curves.png></p> <p><em>Figure: Titration curves for selected residues showing protonation state transitions across pH range. The vertical dashed line indicates physiological pH (7.4).</em></p> <hr> <p><strong>Alternative: Plot pKa Distribution with Protonation States:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=kn>import</span><span class=w> </span><span class=nn>matplotlib.pyplot</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>plt</span>
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=kn>import</span><span class=w> </span><span class=nn>numpy</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>np</span>
<a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>
<a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=n>pka_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>run_analysis</span><span class=p>(</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>)</span>
<a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=n>summary_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>extract_summary</span><span class=p>(</span><span class=n>pka_file</span><span class=p>)</span>
<a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=n>residues</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>parse_summary</span><span class=p>(</span><span class=n>summary_file</span><span class=p>)</span>
<a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a>
<a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=c1># Filter protein residues only</span>
<a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=n>protein_residues</span> <span class=o>=</span> <span class=p>[</span><span class=n>r</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>residues</span> <span class=k>if</span> <span class=n>r</span><span class=p>[</span><span class=s1>&#39;res_id&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>]</span>
<a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a>
<a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a><span class=c1># Set target pH for protonation state analysis</span>
<a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=n>target_ph</span> <span class=o>=</span> <span class=mf>5.0</span>  <span class=c1># Change this to analyze different pH</span>
<a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a>
<a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a><span class=c1># Group by residue type and calculate protonation states</span>
<a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a><span class=n>residue_data</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a><span class=k>for</span> <span class=n>res</span> <span class=ow>in</span> <span class=n>protein_residues</span><span class=p>:</span>
<a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a>    <span class=n>res_type</span> <span class=o>=</span> <span class=n>res</span><span class=p>[</span><span class=s1>&#39;residue&#39;</span><span class=p>]</span>
<a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a>    <span class=k>if</span> <span class=n>res_type</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>residue_data</span><span class=p>:</span>
<a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a>        <span class=n>residue_data</span><span class=p>[</span><span class=n>res_type</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;pka&#39;</span><span class=p>:</span> <span class=p>[],</span> <span class=s1>&#39;protonated&#39;</span><span class=p>:</span> <span class=p>[],</span> <span class=s1>&#39;state&#39;</span><span class=p>:</span> <span class=p>[]}</span>
<a id=__codelineno-27-21 name=__codelineno-27-21 href=#__codelineno-27-21></a>
<a id=__codelineno-27-22 name=__codelineno-27-22 href=#__codelineno-27-22></a>    <span class=n>residue_data</span><span class=p>[</span><span class=n>res_type</span><span class=p>][</span><span class=s1>&#39;pka&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>res</span><span class=p>[</span><span class=s1>&#39;pka&#39;</span><span class=p>])</span>
<a id=__codelineno-27-23 name=__codelineno-27-23 href=#__codelineno-27-23></a>
<a id=__codelineno-27-24 name=__codelineno-27-24 href=#__codelineno-27-24></a>    <span class=c1># Determine protonation state at target pH</span>
<a id=__codelineno-27-25 name=__codelineno-27-25 href=#__codelineno-27-25></a>    <span class=n>state</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>get_default_protonation_state</span><span class=p>(</span><span class=n>res</span><span class=p>,</span> <span class=n>ph</span><span class=o>=</span><span class=n>target_ph</span><span class=p>)</span>
<a id=__codelineno-27-26 name=__codelineno-27-26 href=#__codelineno-27-26></a>    <span class=n>residue_data</span><span class=p>[</span><span class=n>res_type</span><span class=p>][</span><span class=s1>&#39;state&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
<a id=__codelineno-27-27 name=__codelineno-27-27 href=#__codelineno-27-27></a>
<a id=__codelineno-27-28 name=__codelineno-27-28 href=#__codelineno-27-28></a>    <span class=c1># Check if protonated (pH &lt; pKa =&gt; protonated)</span>
<a id=__codelineno-27-29 name=__codelineno-27-29 href=#__codelineno-27-29></a>    <span class=n>is_protonated</span> <span class=o>=</span> <span class=n>target_ph</span> <span class=o>&lt;</span> <span class=n>res</span><span class=p>[</span><span class=s1>&#39;pka&#39;</span><span class=p>]</span>
<a id=__codelineno-27-30 name=__codelineno-27-30 href=#__codelineno-27-30></a>    <span class=n>residue_data</span><span class=p>[</span><span class=n>res_type</span><span class=p>][</span><span class=s1>&#39;protonated&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>is_protonated</span><span class=p>)</span>
<a id=__codelineno-27-31 name=__codelineno-27-31 href=#__codelineno-27-31></a>
<a id=__codelineno-27-32 name=__codelineno-27-32 href=#__codelineno-27-32></a><span class=c1># Prepare data for plotting</span>
<a id=__codelineno-27-33 name=__codelineno-27-33 href=#__codelineno-27-33></a><span class=n>res_names</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-27-34 name=__codelineno-27-34 href=#__codelineno-27-34></a><span class=n>pka_values_list</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-27-35 name=__codelineno-27-35 href=#__codelineno-27-35></a><span class=n>protonation_list</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-27-36 name=__codelineno-27-36 href=#__codelineno-27-36></a><span class=n>colors_list</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-27-37 name=__codelineno-27-37 href=#__codelineno-27-37></a>
<a id=__codelineno-27-38 name=__codelineno-27-38 href=#__codelineno-27-38></a><span class=n>color_map</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;ASP&#39;</span><span class=p>:</span> <span class=s1>&#39;#e74c3c&#39;</span><span class=p>,</span> <span class=s1>&#39;GLU&#39;</span><span class=p>:</span> <span class=s2>&quot;#f92f94&quot;</span><span class=p>,</span> <span class=s1>&#39;HIS&#39;</span><span class=p>:</span> <span class=s2>&quot;#72e183&quot;</span><span class=p>,</span> 
<a id=__codelineno-27-39 name=__codelineno-27-39 href=#__codelineno-27-39></a>             <span class=s1>&#39;LYS&#39;</span><span class=p>:</span> <span class=s2>&quot;#60cae7&quot;</span><span class=p>,</span> <span class=s1>&#39;CYS&#39;</span><span class=p>:</span> <span class=s1>&#39;#9b59b6&#39;</span><span class=p>,</span> <span class=s1>&#39;TYR&#39;</span><span class=p>:</span> <span class=s2>&quot;#5b76f8&quot;</span><span class=p>,</span> 
<a id=__codelineno-27-40 name=__codelineno-27-40 href=#__codelineno-27-40></a>             <span class=s1>&#39;ARG&#39;</span><span class=p>:</span> <span class=s1>&#39;#f39c12&#39;</span><span class=p>,</span> <span class=s1>&#39;N+&#39;</span><span class=p>:</span> <span class=s1>&#39;#95a5a6&#39;</span><span class=p>,</span> <span class=s1>&#39;C-&#39;</span><span class=p>:</span> <span class=s1>&#39;#34495e&#39;</span><span class=p>}</span>
<a id=__codelineno-27-41 name=__codelineno-27-41 href=#__codelineno-27-41></a>
<a id=__codelineno-27-42 name=__codelineno-27-42 href=#__codelineno-27-42></a><span class=k>for</span> <span class=n>res_type</span> <span class=ow>in</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>residue_data</span><span class=o>.</span><span class=n>keys</span><span class=p>()):</span>
<a id=__codelineno-27-43 name=__codelineno-27-43 href=#__codelineno-27-43></a>    <span class=n>res_names</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>res_type</span><span class=p>)</span>
<a id=__codelineno-27-44 name=__codelineno-27-44 href=#__codelineno-27-44></a>    <span class=n>pka_values_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>residue_data</span><span class=p>[</span><span class=n>res_type</span><span class=p>][</span><span class=s1>&#39;pka&#39;</span><span class=p>])</span>
<a id=__codelineno-27-45 name=__codelineno-27-45 href=#__codelineno-27-45></a>    <span class=n>protonation_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>residue_data</span><span class=p>[</span><span class=n>res_type</span><span class=p>][</span><span class=s1>&#39;protonated&#39;</span><span class=p>])</span>
<a id=__codelineno-27-46 name=__codelineno-27-46 href=#__codelineno-27-46></a>    <span class=n>colors_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>color_map</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>res_type</span><span class=p>,</span> <span class=s1>&#39;#7f8c8d&#39;</span><span class=p>))</span>
<a id=__codelineno-27-47 name=__codelineno-27-47 href=#__codelineno-27-47></a>
<a id=__codelineno-27-48 name=__codelineno-27-48 href=#__codelineno-27-48></a><span class=c1># Create figure with two subplots</span>
<a id=__codelineno-27-49 name=__codelineno-27-49 href=#__codelineno-27-49></a><span class=n>fig</span><span class=p>,</span> <span class=p>(</span><span class=n>ax1</span><span class=p>,</span> <span class=n>ax2</span><span class=p>)</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span> <span class=mi>10</span><span class=p>),</span> 
<a id=__codelineno-27-50 name=__codelineno-27-50 href=#__codelineno-27-50></a>                                <span class=n>gridspec_kw</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;height_ratios&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>]})</span>
<a id=__codelineno-27-51 name=__codelineno-27-51 href=#__codelineno-27-51></a>
<a id=__codelineno-27-52 name=__codelineno-27-52 href=#__codelineno-27-52></a><span class=c1># --- Top plot: pKa distribution with protonation states ---</span>
<a id=__codelineno-27-53 name=__codelineno-27-53 href=#__codelineno-27-53></a><span class=n>bp</span> <span class=o>=</span> <span class=n>ax1</span><span class=o>.</span><span class=n>boxplot</span><span class=p>(</span><span class=n>pka_values_list</span><span class=p>,</span> <span class=n>labels</span><span class=o>=</span><span class=n>res_names</span><span class=p>,</span> <span class=n>patch_artist</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-27-54 name=__codelineno-27-54 href=#__codelineno-27-54></a>                 <span class=n>showmeans</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>meanline</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
<a id=__codelineno-27-55 name=__codelineno-27-55 href=#__codelineno-27-55></a>                 <span class=n>medianprops</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;color&#39;</span><span class=p>:</span> <span class=s1>&#39;black&#39;</span><span class=p>,</span> <span class=s1>&#39;linewidth&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>},</span>
<a id=__codelineno-27-56 name=__codelineno-27-56 href=#__codelineno-27-56></a>                 <span class=n>meanprops</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;marker&#39;</span><span class=p>:</span> <span class=s1>&#39;D&#39;</span><span class=p>,</span> <span class=s1>&#39;markerfacecolor&#39;</span><span class=p>:</span> <span class=s1>&#39;red&#39;</span><span class=p>,</span> 
<a id=__codelineno-27-57 name=__codelineno-27-57 href=#__codelineno-27-57></a>                           <span class=s1>&#39;markeredgecolor&#39;</span><span class=p>:</span> <span class=s1>&#39;darkred&#39;</span><span class=p>,</span> <span class=s1>&#39;markersize&#39;</span><span class=p>:</span> <span class=mi>6</span><span class=p>})</span>
<a id=__codelineno-27-58 name=__codelineno-27-58 href=#__codelineno-27-58></a>
<a id=__codelineno-27-59 name=__codelineno-27-59 href=#__codelineno-27-59></a><span class=c1># Color each box</span>
<a id=__codelineno-27-60 name=__codelineno-27-60 href=#__codelineno-27-60></a><span class=k>for</span> <span class=n>patch</span><span class=p>,</span> <span class=n>color</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>bp</span><span class=p>[</span><span class=s1>&#39;boxes&#39;</span><span class=p>],</span> <span class=n>colors_list</span><span class=p>):</span>
<a id=__codelineno-27-61 name=__codelineno-27-61 href=#__codelineno-27-61></a>    <span class=n>patch</span><span class=o>.</span><span class=n>set_facecolor</span><span class=p>(</span><span class=n>color</span><span class=p>)</span>
<a id=__codelineno-27-62 name=__codelineno-27-62 href=#__codelineno-27-62></a>    <span class=n>patch</span><span class=o>.</span><span class=n>set_alpha</span><span class=p>(</span><span class=mf>0.6</span><span class=p>)</span>
<a id=__codelineno-27-63 name=__codelineno-27-63 href=#__codelineno-27-63></a>
<a id=__codelineno-27-64 name=__codelineno-27-64 href=#__codelineno-27-64></a><span class=c1># Add individual points colored by protonation state</span>
<a id=__codelineno-27-65 name=__codelineno-27-65 href=#__codelineno-27-65></a><span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=p>(</span><span class=n>res_type</span><span class=p>,</span> <span class=n>pka_vals</span><span class=p>,</span> <span class=n>prot_states</span><span class=p>)</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=nb>zip</span><span class=p>(</span><span class=n>res_names</span><span class=p>,</span> <span class=n>pka_values_list</span><span class=p>,</span> <span class=n>protonation_list</span><span class=p>)):</span>
<a id=__codelineno-27-66 name=__codelineno-27-66 href=#__codelineno-27-66></a>    <span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>normal</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span> <span class=mf>0.04</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=n>pka_vals</span><span class=p>))</span>
<a id=__codelineno-27-67 name=__codelineno-27-67 href=#__codelineno-27-67></a>    <span class=c1># Protonated = filled circles, Deprotonated = open circles</span>
<a id=__codelineno-27-68 name=__codelineno-27-68 href=#__codelineno-27-68></a>    <span class=k>for</span> <span class=n>xi</span><span class=p>,</span> <span class=n>pka</span><span class=p>,</span> <span class=n>is_prot</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>pka_vals</span><span class=p>,</span> <span class=n>prot_states</span><span class=p>):</span>
<a id=__codelineno-27-69 name=__codelineno-27-69 href=#__codelineno-27-69></a>        <span class=k>if</span> <span class=n>is_prot</span><span class=p>:</span>
<a id=__codelineno-27-70 name=__codelineno-27-70 href=#__codelineno-27-70></a>            <span class=n>ax1</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>xi</span><span class=p>,</span> <span class=n>pka</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=n>colors_list</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.7</span><span class=p>,</span> 
<a id=__codelineno-27-71 name=__codelineno-27-71 href=#__codelineno-27-71></a>                       <span class=n>edgecolors</span><span class=o>=</span><span class=s1>&#39;black&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>marker</span><span class=o>=</span><span class=s1>&#39;o&#39;</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
<a id=__codelineno-27-72 name=__codelineno-27-72 href=#__codelineno-27-72></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-27-73 name=__codelineno-27-73 href=#__codelineno-27-73></a>            <span class=n>ax1</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>xi</span><span class=p>,</span> <span class=n>pka</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span> <span class=n>facecolors</span><span class=o>=</span><span class=s1>&#39;none&#39;</span><span class=p>,</span> <span class=n>edgecolors</span><span class=o>=</span><span class=n>colors_list</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> 
<a id=__codelineno-27-74 name=__codelineno-27-74 href=#__codelineno-27-74></a>                       <span class=n>alpha</span><span class=o>=</span><span class=mf>0.7</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>marker</span><span class=o>=</span><span class=s1>&#39;o&#39;</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
<a id=__codelineno-27-75 name=__codelineno-27-75 href=#__codelineno-27-75></a>
<a id=__codelineno-27-76 name=__codelineno-27-76 href=#__codelineno-27-76></a><span class=c1># Add pH reference line</span>
<a id=__codelineno-27-77 name=__codelineno-27-77 href=#__codelineno-27-77></a><span class=n>ax1</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span><span class=n>y</span><span class=o>=</span><span class=n>target_ph</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;red&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mf>2.5</span><span class=p>,</span> 
<a id=__codelineno-27-78 name=__codelineno-27-78 href=#__codelineno-27-78></a>           <span class=n>alpha</span><span class=o>=</span><span class=mf>0.8</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=sa>f</span><span class=s1>&#39;pH </span><span class=si>{</span><span class=n>target_ph</span><span class=si>}</span><span class=s1> (target)&#39;</span><span class=p>,</span> <span class=n>zorder</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
<a id=__codelineno-27-79 name=__codelineno-27-79 href=#__codelineno-27-79></a>
<a id=__codelineno-27-80 name=__codelineno-27-80 href=#__codelineno-27-80></a><span class=n>ax1</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s1>&#39;pKa&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>13</span><span class=p>,</span> <span class=n>fontweight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
<a id=__codelineno-27-81 name=__codelineno-27-81 href=#__codelineno-27-81></a><span class=n>ax1</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;pKa Distribution and Protonation States at pH </span><span class=si>{</span><span class=n>target_ph</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span> 
<a id=__codelineno-27-82 name=__codelineno-27-82 href=#__codelineno-27-82></a>              <span class=n>fontsize</span><span class=o>=</span><span class=mi>15</span><span class=p>,</span> <span class=n>fontweight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
<a id=__codelineno-27-83 name=__codelineno-27-83 href=#__codelineno-27-83></a><span class=n>ax1</span><span class=o>.</span><span class=n>grid</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.3</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=s1>&#39;y&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;:&#39;</span><span class=p>)</span>
<a id=__codelineno-27-84 name=__codelineno-27-84 href=#__codelineno-27-84></a><span class=n>ax1</span><span class=o>.</span><span class=n>legend</span><span class=p>(</span><span class=n>loc</span><span class=o>=</span><span class=s1>&#39;upper right&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>11</span><span class=p>)</span>
<a id=__codelineno-27-85 name=__codelineno-27-85 href=#__codelineno-27-85></a><span class=n>ax1</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span>
<a id=__codelineno-27-86 name=__codelineno-27-86 href=#__codelineno-27-86></a>
<a id=__codelineno-27-87 name=__codelineno-27-87 href=#__codelineno-27-87></a><span class=c1># Add legend for protonation states</span>
<a id=__codelineno-27-88 name=__codelineno-27-88 href=#__codelineno-27-88></a><span class=kn>from</span><span class=w> </span><span class=nn>matplotlib.patches</span><span class=w> </span><span class=kn>import</span> <span class=n>Patch</span>
<a id=__codelineno-27-89 name=__codelineno-27-89 href=#__codelineno-27-89></a><span class=kn>from</span><span class=w> </span><span class=nn>matplotlib.lines</span><span class=w> </span><span class=kn>import</span> <span class=n>Line2D</span>
<a id=__codelineno-27-90 name=__codelineno-27-90 href=#__codelineno-27-90></a><span class=n>legend_elements</span> <span class=o>=</span> <span class=p>[</span>
<a id=__codelineno-27-91 name=__codelineno-27-91 href=#__codelineno-27-91></a>    <span class=n>Line2D</span><span class=p>([</span><span class=mi>0</span><span class=p>],</span> <span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>marker</span><span class=o>=</span><span class=s1>&#39;o&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;w&#39;</span><span class=p>,</span> <span class=n>markerfacecolor</span><span class=o>=</span><span class=s1>&#39;gray&#39;</span><span class=p>,</span> 
<a id=__codelineno-27-92 name=__codelineno-27-92 href=#__codelineno-27-92></a>           <span class=n>markersize</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>markeredgecolor</span><span class=o>=</span><span class=s1>&#39;black&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> 
<a id=__codelineno-27-93 name=__codelineno-27-93 href=#__codelineno-27-93></a>           <span class=n>label</span><span class=o>=</span><span class=s1>&#39;Protonated (pH &lt; pKa)&#39;</span><span class=p>),</span>
<a id=__codelineno-27-94 name=__codelineno-27-94 href=#__codelineno-27-94></a>    <span class=n>Line2D</span><span class=p>([</span><span class=mi>0</span><span class=p>],</span> <span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>marker</span><span class=o>=</span><span class=s1>&#39;o&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;w&#39;</span><span class=p>,</span> <span class=n>markerfacecolor</span><span class=o>=</span><span class=s1>&#39;none&#39;</span><span class=p>,</span> 
<a id=__codelineno-27-95 name=__codelineno-27-95 href=#__codelineno-27-95></a>           <span class=n>markersize</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>markeredgecolor</span><span class=o>=</span><span class=s1>&#39;gray&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> 
<a id=__codelineno-27-96 name=__codelineno-27-96 href=#__codelineno-27-96></a>           <span class=n>label</span><span class=o>=</span><span class=s1>&#39;Deprotonated (pH ≥ pKa)&#39;</span><span class=p>)</span>
<a id=__codelineno-27-97 name=__codelineno-27-97 href=#__codelineno-27-97></a><span class=p>]</span>
<a id=__codelineno-27-98 name=__codelineno-27-98 href=#__codelineno-27-98></a><span class=n>ax1</span><span class=o>.</span><span class=n>legend</span><span class=p>(</span><span class=n>handles</span><span class=o>=</span><span class=n>legend_elements</span><span class=p>,</span> <span class=n>loc</span><span class=o>=</span><span class=s1>&#39;upper left&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
<a id=__codelineno-27-99 name=__codelineno-27-99 href=#__codelineno-27-99></a>
<a id=__codelineno-27-100 name=__codelineno-27-100 href=#__codelineno-27-100></a><span class=c1># --- Bottom plot: Protonation fraction bar chart ---</span>
<a id=__codelineno-27-101 name=__codelineno-27-101 href=#__codelineno-27-101></a><span class=n>protonation_fractions</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-27-102 name=__codelineno-27-102 href=#__codelineno-27-102></a><span class=k>for</span> <span class=n>prot_states</span> <span class=ow>in</span> <span class=n>protonation_list</span><span class=p>:</span>
<a id=__codelineno-27-103 name=__codelineno-27-103 href=#__codelineno-27-103></a>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>prot_states</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
<a id=__codelineno-27-104 name=__codelineno-27-104 href=#__codelineno-27-104></a>        <span class=n>fraction</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>prot_states</span><span class=p>)</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>prot_states</span><span class=p>)</span>
<a id=__codelineno-27-105 name=__codelineno-27-105 href=#__codelineno-27-105></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-27-106 name=__codelineno-27-106 href=#__codelineno-27-106></a>        <span class=n>fraction</span> <span class=o>=</span> <span class=mi>0</span>
<a id=__codelineno-27-107 name=__codelineno-27-107 href=#__codelineno-27-107></a>    <span class=n>protonation_fractions</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>fraction</span><span class=p>)</span>
<a id=__codelineno-27-108 name=__codelineno-27-108 href=#__codelineno-27-108></a>
<a id=__codelineno-27-109 name=__codelineno-27-109 href=#__codelineno-27-109></a><span class=n>bars</span> <span class=o>=</span> <span class=n>ax2</span><span class=o>.</span><span class=n>bar</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>res_names</span><span class=p>)</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span> <span class=n>protonation_fractions</span><span class=p>,</span> 
<a id=__codelineno-27-110 name=__codelineno-27-110 href=#__codelineno-27-110></a>               <span class=n>color</span><span class=o>=</span><span class=n>colors_list</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.7</span><span class=p>,</span> <span class=n>edgecolor</span><span class=o>=</span><span class=s1>&#39;black&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mf>1.5</span><span class=p>)</span>
<a id=__codelineno-27-111 name=__codelineno-27-111 href=#__codelineno-27-111></a>
<a id=__codelineno-27-112 name=__codelineno-27-112 href=#__codelineno-27-112></a><span class=c1># Add percentage labels on bars</span>
<a id=__codelineno-27-113 name=__codelineno-27-113 href=#__codelineno-27-113></a><span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=p>(</span><span class=n>bar</span><span class=p>,</span> <span class=n>frac</span><span class=p>)</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=nb>zip</span><span class=p>(</span><span class=n>bars</span><span class=p>,</span> <span class=n>protonation_fractions</span><span class=p>)):</span>
<a id=__codelineno-27-114 name=__codelineno-27-114 href=#__codelineno-27-114></a>    <span class=n>height</span> <span class=o>=</span> <span class=n>bar</span><span class=o>.</span><span class=n>get_height</span><span class=p>()</span>
<a id=__codelineno-27-115 name=__codelineno-27-115 href=#__codelineno-27-115></a>    <span class=n>ax2</span><span class=o>.</span><span class=n>text</span><span class=p>(</span><span class=n>bar</span><span class=o>.</span><span class=n>get_x</span><span class=p>()</span> <span class=o>+</span> <span class=n>bar</span><span class=o>.</span><span class=n>get_width</span><span class=p>()</span><span class=o>/</span><span class=mf>2.</span><span class=p>,</span> <span class=n>height</span> <span class=o>+</span> <span class=mf>0.02</span><span class=p>,</span>
<a id=__codelineno-27-116 name=__codelineno-27-116 href=#__codelineno-27-116></a>             <span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>frac</span><span class=o>*</span><span class=mi>100</span><span class=si>:</span><span class=s1>.0f</span><span class=si>}</span><span class=s1>%&#39;</span><span class=p>,</span> <span class=n>ha</span><span class=o>=</span><span class=s1>&#39;center&#39;</span><span class=p>,</span> <span class=n>va</span><span class=o>=</span><span class=s1>&#39;bottom&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>fontweight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
<a id=__codelineno-27-117 name=__codelineno-27-117 href=#__codelineno-27-117></a>
<a id=__codelineno-27-118 name=__codelineno-27-118 href=#__codelineno-27-118></a><span class=n>ax2</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s1>&#39;Residue Type&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>13</span><span class=p>,</span> <span class=n>fontweight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
<a id=__codelineno-27-119 name=__codelineno-27-119 href=#__codelineno-27-119></a><span class=n>ax2</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s1>&#39;Protonated Fraction&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>13</span><span class=p>,</span> <span class=n>fontweight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
<a id=__codelineno-27-120 name=__codelineno-27-120 href=#__codelineno-27-120></a><span class=n>ax2</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Protonation State Distribution at pH </span><span class=si>{</span><span class=n>target_ph</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>14</span><span class=p>,</span> <span class=n>fontweight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
<a id=__codelineno-27-121 name=__codelineno-27-121 href=#__codelineno-27-121></a><span class=n>ax2</span><span class=o>.</span><span class=n>set_xticks</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>res_names</span><span class=p>)</span><span class=o>+</span><span class=mi>1</span><span class=p>))</span>
<a id=__codelineno-27-122 name=__codelineno-27-122 href=#__codelineno-27-122></a><span class=n>ax2</span><span class=o>.</span><span class=n>set_xticklabels</span><span class=p>(</span><span class=n>res_names</span><span class=p>)</span>
<a id=__codelineno-27-123 name=__codelineno-27-123 href=#__codelineno-27-123></a><span class=n>ax2</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mf>1.1</span><span class=p>)</span>
<a id=__codelineno-27-124 name=__codelineno-27-124 href=#__codelineno-27-124></a><span class=n>ax2</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span><span class=n>y</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;gray&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;:&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.5</span><span class=p>)</span>
<a id=__codelineno-27-125 name=__codelineno-27-125 href=#__codelineno-27-125></a><span class=n>ax2</span><span class=o>.</span><span class=n>grid</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.3</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=s1>&#39;y&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;:&#39;</span><span class=p>)</span>
<a id=__codelineno-27-126 name=__codelineno-27-126 href=#__codelineno-27-126></a>
<a id=__codelineno-27-127 name=__codelineno-27-127 href=#__codelineno-27-127></a><span class=n>plt</span><span class=o>.</span><span class=n>tight_layout</span><span class=p>()</span>
<a id=__codelineno-27-128 name=__codelineno-27-128 href=#__codelineno-27-128></a><span class=n>plt</span><span class=o>.</span><span class=n>savefig</span><span class=p>(</span><span class=s1>&#39;propka_pka_distribution.png&#39;</span><span class=p>,</span> <span class=n>dpi</span><span class=o>=</span><span class=mi>600</span><span class=p>,</span> <span class=n>bbox_inches</span><span class=o>=</span><span class=s1>&#39;tight&#39;</span><span class=p>)</span>
<a id=__codelineno-27-129 name=__codelineno-27-129 href=#__codelineno-27-129></a><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
<a id=__codelineno-27-130 name=__codelineno-27-130 href=#__codelineno-27-130></a>
<a id=__codelineno-27-131 name=__codelineno-27-131 href=#__codelineno-27-131></a><span class=c1># Print statistics</span>
<a id=__codelineno-27-132 name=__codelineno-27-132 href=#__codelineno-27-132></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>pKa Statistics and Protonation States at pH </span><span class=si>{</span><span class=n>target_ph</span><span class=si>}</span><span class=s2>:&quot;</span><span class=p>)</span>
<a id=__codelineno-27-133 name=__codelineno-27-133 href=#__codelineno-27-133></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;=&quot;</span> <span class=o>*</span> <span class=mi>80</span><span class=p>)</span>
<a id=__codelineno-27-134 name=__codelineno-27-134 href=#__codelineno-27-134></a><span class=k>for</span> <span class=n>res_type</span><span class=p>,</span> <span class=n>data</span> <span class=ow>in</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>residue_data</span><span class=o>.</span><span class=n>items</span><span class=p>()):</span>
<a id=__codelineno-27-135 name=__codelineno-27-135 href=#__codelineno-27-135></a>    <span class=n>pka_vals</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;pka&#39;</span><span class=p>]</span>
<a id=__codelineno-27-136 name=__codelineno-27-136 href=#__codelineno-27-136></a>    <span class=n>n_prot</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;protonated&#39;</span><span class=p>])</span>
<a id=__codelineno-27-137 name=__codelineno-27-137 href=#__codelineno-27-137></a>    <span class=n>n_total</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>pka_vals</span><span class=p>)</span>
<a id=__codelineno-27-138 name=__codelineno-27-138 href=#__codelineno-27-138></a>    <span class=n>prot_frac</span> <span class=o>=</span> <span class=n>n_prot</span> <span class=o>/</span> <span class=n>n_total</span> <span class=k>if</span> <span class=n>n_total</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span>
<a id=__codelineno-27-139 name=__codelineno-27-139 href=#__codelineno-27-139></a>
<a id=__codelineno-27-140 name=__codelineno-27-140 href=#__codelineno-27-140></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=se>\n</span><span class=si>{</span><span class=n>res_type</span><span class=si>:</span><span class=s2>4s</span><span class=si>}</span><span class=s2>: n=</span><span class=si>{</span><span class=n>n_total</span><span class=si>:</span><span class=s2>2d</span><span class=si>}</span><span class=s2>  &quot;</span>
<a id=__codelineno-27-141 name=__codelineno-27-141 href=#__codelineno-27-141></a>          <span class=sa>f</span><span class=s2>&quot;pKa range=[</span><span class=si>{</span><span class=nb>min</span><span class=p>(</span><span class=n>pka_vals</span><span class=p>)</span><span class=si>:</span><span class=s2>5.2f</span><span class=si>}</span><span class=s2>, </span><span class=si>{</span><span class=nb>max</span><span class=p>(</span><span class=n>pka_vals</span><span class=p>)</span><span class=si>:</span><span class=s2>5.2f</span><span class=si>}</span><span class=s2>]  &quot;</span>
<a id=__codelineno-27-142 name=__codelineno-27-142 href=#__codelineno-27-142></a>          <span class=sa>f</span><span class=s2>&quot;mean=</span><span class=si>{</span><span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>pka_vals</span><span class=p>)</span><span class=si>:</span><span class=s2>5.2f</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-27-143 name=__codelineno-27-143 href=#__codelineno-27-143></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;      Protonated: </span><span class=si>{</span><span class=n>n_prot</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>n_total</span><span class=si>}</span><span class=s2> (</span><span class=si>{</span><span class=n>prot_frac</span><span class=o>*</span><span class=mi>100</span><span class=si>:</span><span class=s2>.0f</span><span class=si>}</span><span class=s2>%)  &quot;</span>
<a id=__codelineno-27-144 name=__codelineno-27-144 href=#__codelineno-27-144></a>          <span class=sa>f</span><span class=s2>&quot;Deprotonated: </span><span class=si>{</span><span class=n>n_total</span><span class=o>-</span><span class=n>n_prot</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>n_total</span><span class=si>}</span><span class=s2> (</span><span class=si>{</span><span class=p>(</span><span class=mi>1</span><span class=o>-</span><span class=n>prot_frac</span><span class=p>)</span><span class=o>*</span><span class=mi>100</span><span class=si>:</span><span class=s2>.0f</span><span class=si>}</span><span class=s2>%)&quot;</span><span class=p>)</span>
<a id=__codelineno-27-145 name=__codelineno-27-145 href=#__codelineno-27-145></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;      States: </span><span class=si>{</span><span class=s1>&#39;, &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;state&#39;</span><span class=p>]))</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div> <p><strong>Example Output:</strong></p> <p><img alt="pKa Distribution with Protonation States" src=../../images/api/propka_pka_distribution.png></p> <p><em>Figure: (Top) pKa distribution by residue type with protonation states at pH 5.0. Filled circles indicate protonated residues (pH &lt; pKa), open circles indicate deprotonated residues (pH ≥ pKa). The red dashed line shows the target pH. (Bottom) Fraction of each residue type that is protonated at pH 5.0.</em></p> <hr> <h2 id=protein-capping>Protein Capping<a class=headerlink href=#protein-capping title="Permanent link">&para;</a></h2> <p><strong>Module:</strong> <code>gatewizard.utils.protein_capping</code></p> <p>Protein capping adds <strong>ACE</strong> (N-acetyl) and <strong>NME</strong> (N-methylamide) groups to protein termini to:</p> <ul> <li>Neutralize charges at termini</li> <li>Improve Propka analysis accuracy</li> <li>Better represent membrane protein environments</li> <li>Mimic peptide bond continuation in protein fragments</li> </ul> <h3 id=class-proteincapper>Class: ProteinCapper<a class=headerlink href=#class-proteincapper title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.utils.protein_capping</span><span class=w> </span><span class=kn>import</span> <span class=n>ProteinCapper</span><span class=p>,</span> <span class=n>cap_protein</span>
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=n>capper</span> <span class=o>=</span> <span class=n>ProteinCapper</span><span class=p>()</span>
</code></pre></div> <h3 id=method-remove_hydrogens_and_cap>Method: remove_hydrogens_and_cap()<a class=headerlink href=#method-remove_hydrogens_and_cap title="Permanent link">&para;</a></h3> <p>Main method to add ACE/NME caps and track residue renumbering.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=n>remove_hydrogens_and_cap</span><span class=p>(</span>
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a>    <span class=n>input_file</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Path</span><span class=p>],</span>
<a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a>    <span class=n>output_file</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Path</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a>    <span class=n>target_dir</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Path</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>]</span>
</code></pre></div> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Parameter</th> <th>Type</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>input_file</code></td> <td><code>str/Path</code></td> <td>Required</td> <td>Input PDB file</td> </tr> <tr> <td><code>output_file</code></td> <td><code>str/Path</code></td> <td><code>None</code></td> <td>Output file (auto-generated if None)</td> </tr> <tr> <td><code>target_dir</code></td> <td><code>str/Path</code></td> <td><code>None</code></td> <td>Directory for mapping file</td> </tr> </tbody> </table> <p><strong>Returns:</strong> <code>Tuple[str, Dict]</code></p> <ul> <li><code>str</code> - Path to capped PDB file</li> <li><code>Dict</code> - Residue mapping dictionary</li> </ul> <p><strong>Residue Mapping Dictionary:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=p>{</span>
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>    <span class=p>(</span><span class=n>original_resname</span><span class=p>,</span> <span class=n>chain</span><span class=p>,</span> <span class=n>original_resid</span><span class=p>):</span> <span class=p>(</span><span class=n>new_resname</span><span class=p>,</span> <span class=n>chain</span><span class=p>,</span> <span class=n>new_resid</span><span class=p>),</span>
<a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a>    <span class=o>...</span>
<a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=p>}</span>
</code></pre></div> <p><strong>What Happens During Capping:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a>Before: MET1 - ALA2 - ... - GLY50
<a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a>After:  ACE1 - MET2 - ALA3 - ... - GLY51 - NME52
</code></pre></div> <p>All residue numbers shift by +1, and ACE/NME caps are added.</p> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.utils.protein_capping</span><span class=w> </span><span class=kn>import</span> <span class=n>ProteinCapper</span>
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a>
<a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=n>capper</span> <span class=o>=</span> <span class=n>ProteinCapper</span><span class=p>()</span>
<a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a>
<a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=c1># Add caps and get mapping</span>
<a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a><span class=n>capped_file</span><span class=p>,</span> <span class=n>residue_mapping</span> <span class=o>=</span> <span class=n>capper</span><span class=o>.</span><span class=n>remove_hydrogens_and_cap</span><span class=p>(</span>
<a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a>    <span class=n>input_file</span><span class=o>=</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a>    <span class=n>output_file</span><span class=o>=</span><span class=s2>&quot;protein_capped.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a>    <span class=n>target_dir</span><span class=o>=</span><span class=s2>&quot;output&quot;</span>
<a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a><span class=p>)</span>
<a id=__codelineno-32-11 name=__codelineno-32-11 href=#__codelineno-32-11></a>
<a id=__codelineno-32-12 name=__codelineno-32-12 href=#__codelineno-32-12></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Capped protein: </span><span class=si>{</span><span class=n>capped_file</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-32-13 name=__codelineno-32-13 href=#__codelineno-32-13></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Residue mapping: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>residue_mapping</span><span class=p>)</span><span class=si>}</span><span class=s2> residues tracked&quot;</span><span class=p>)</span>
<a id=__codelineno-32-14 name=__codelineno-32-14 href=#__codelineno-32-14></a>
<a id=__codelineno-32-15 name=__codelineno-32-15 href=#__codelineno-32-15></a><span class=c1># Show first few mappings</span>
<a id=__codelineno-32-16 name=__codelineno-32-16 href=#__codelineno-32-16></a><span class=k>for</span> <span class=p>(</span><span class=n>orig_resname</span><span class=p>,</span> <span class=n>chain</span><span class=p>,</span> <span class=n>orig_resid</span><span class=p>),</span> <span class=p>(</span><span class=n>new_resname</span><span class=p>,</span> <span class=n>new_chain</span><span class=p>,</span> <span class=n>new_resid</span><span class=p>)</span> <span class=ow>in</span> <span class=nb>list</span><span class=p>(</span><span class=n>residue_mapping</span><span class=o>.</span><span class=n>items</span><span class=p>())[:</span><span class=mi>5</span><span class=p>]:</span>
<a id=__codelineno-32-17 name=__codelineno-32-17 href=#__codelineno-32-17></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  </span><span class=si>{</span><span class=n>orig_resname</span><span class=si>}{</span><span class=n>orig_resid</span><span class=si>}</span><span class=s2> (Chain </span><span class=si>{</span><span class=n>chain</span><span class=si>}</span><span class=s2>) → </span><span class=si>{</span><span class=n>new_resname</span><span class=si>}{</span><span class=n>new_resid</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-32-18 name=__codelineno-32-18 href=#__codelineno-32-18></a><span class=c1># Output:</span>
<a id=__codelineno-32-19 name=__codelineno-32-19 href=#__codelineno-32-19></a><span class=c1>#  LEU1 (Chain A) → LEU2</span>
<a id=__codelineno-32-20 name=__codelineno-32-20 href=#__codelineno-32-20></a><span class=c1>#  PRO2 (Chain A) → PRO3</span>
<a id=__codelineno-32-21 name=__codelineno-32-21 href=#__codelineno-32-21></a><span class=c1>#  ALA3 (Chain A) → ALA4</span>
<a id=__codelineno-32-22 name=__codelineno-32-22 href=#__codelineno-32-22></a><span class=c1>#  GLY4 (Chain A) → GLY5</span>
<a id=__codelineno-32-23 name=__codelineno-32-23 href=#__codelineno-32-23></a><span class=c1>#  ILE5 (Chain A) → ILE6</span>
</code></pre></div></p> <h3 id=convenience-function-cap_protein>Convenience Function: cap_protein()<a class=headerlink href=#convenience-function-cap_protein title="Permanent link">&para;</a></h3> <p>Simplified wrapper for protein capping.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.utils.protein_capping</span><span class=w> </span><span class=kn>import</span> <span class=n>cap_protein</span>
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>
<a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=n>capped_file</span><span class=p>,</span> <span class=n>mapping</span> <span class=o>=</span> <span class=n>cap_protein</span><span class=p>(</span>
<a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a>    <span class=n>input_file</span><span class=o>=</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a>    <span class=n>output_file</span><span class=o>=</span><span class=s2>&quot;protein_capped.pdb&quot;</span>
<a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=p>)</span>
</code></pre></div> <hr> <h2 id=pdb4amber-integration>pdb4amber Integration<a class=headerlink href=#pdb4amber-integration title="Permanent link">&para;</a></h2> <p><strong>Important Distinction:</strong></p> <table> <thead> <tr> <th>Method</th> <th>Runs pdb4amber?</th> <th>Output</th> </tr> </thead> <tbody> <tr> <td><strong>GUI</strong> "Apply States &amp; Run pdb4amber" button</td> <td>✅ <strong>YES</strong> (automatic)</td> <td>AMBER-ready PDB with hydrogens</td> </tr> <tr> <td><strong>API</strong> <code>apply_protonation_states()</code></td> <td>❌ <strong>NO</strong> (manual)</td> <td>Only residue name changes</td> </tr> <tr> <td><strong>API</strong> <code>apply_disulfide_bonds()</code></td> <td>❌ <strong>NO</strong> (manual)</td> <td>Only CYS→CYX changes</td> </tr> </tbody> </table> <p>The API methods only modify residue names in PDB files. For MD simulations, you must run pdb4amber separately:</p> <p><strong>Option 1: Command Line</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a>pdb4amber<span class=w> </span>-i<span class=w> </span>protein_protonated_ss.pdb<span class=w> </span>-o<span class=w> </span>protein_prepared.pdb
</code></pre></div></p> <p><strong>Option 2: Python subprocess</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=kn>import</span><span class=w> </span><span class=nn>subprocess</span>
<a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a>
<a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=n>result</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>([</span>
<a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a>    <span class=s2>&quot;pdb4amber&quot;</span><span class=p>,</span>
<a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a>    <span class=s2>&quot;-i&quot;</span><span class=p>,</span> <span class=s2>&quot;protein_protonated_ss.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a>    <span class=s2>&quot;-o&quot;</span><span class=p>,</span> <span class=s2>&quot;protein_prepared.pdb&quot;</span>
<a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a><span class=p>],</span> <span class=n>capture_output</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>text</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>check</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></div></p> <h3 id=acenme-cap-hetatm-fix>ACE/NME Cap HETATM Fix<a class=headerlink href=#acenme-cap-hetatm-fix title="Permanent link">&para;</a></h3> <p><strong>Critical Note:</strong> When using protein capping (ACE/NME), pdb4amber converts cap ATOM records to HETATM records, which can cause compatibility issues with downstream tools like packmol-memgen.</p> <p><strong>The Problem:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a># Before pdb4amber (correct for caps):
<a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>ATOM      1  C   ACE A   1      12.640  -9.437  14.871  1.00  0.00      A
<a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a>ATOM      2  CH3 ACE A   1      12.660 -10.927  15.173  1.00  0.00      A
<a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a>
<a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a># After pdb4amber (incorrect - becomes heteroatom):
<a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a>HETATM    1  C   ACE A   1      12.640  -9.437  14.871  1.00  0.00           C
<a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a>HETATM    2  CH3 ACE A   1      12.660 -10.927  15.173  1.00  0.00           C
</code></pre></div></p> <h3 id=method-run_pdb4amber_with_cap_fix>Method: run_pdb4amber_with_cap_fix()<a class=headerlink href=#method-run_pdb4amber_with_cap_fix title="Permanent link">&para;</a></h3> <p>Run pdb4amber to add hydrogens and prepare PDB for AMBER, with optional ACE/NME cap HETATM fix.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=n>run_pdb4amber_with_cap_fix</span><span class=p>(</span>
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a>    <span class=n>input_pdb</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a>    <span class=n>output_pdb</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a>    <span class=n>fix_caps</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a>    <span class=n>pdb4amber_options</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span>
</code></pre></div> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Parameter</th> <th>Type</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>input_pdb</code></td> <td><code>str</code></td> <td>Required</td> <td>Path to input PDB file</td> </tr> <tr> <td><code>output_pdb</code></td> <td><code>str</code></td> <td>Required</td> <td>Path for output PDB file</td> </tr> <tr> <td><code>fix_caps</code></td> <td><code>bool</code></td> <td><code>True</code></td> <td>If True, automatically converts ACE/NME HETATM→ATOM after pdb4amber</td> </tr> <tr> <td><code>pdb4amber_options</code></td> <td><code>Dict[str, Any]</code></td> <td><code>None</code></td> <td>Optional dictionary of pdb4amber command-line options</td> </tr> </tbody> </table> <p><strong>Returns:</strong> <code>Dict[str, Any]</code> - Result dictionary with execution details</p> <p><strong>Return Dictionary:</strong></p> <table> <thead> <tr> <th>Key</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>"success"</code></td> <td><code>bool</code></td> <td>Whether pdb4amber execution succeeded</td> </tr> <tr> <td><code>"output_file"</code></td> <td><code>str</code></td> <td>Path to the output PDB file</td> </tr> <tr> <td><code>"hetatm_fixed"</code></td> <td><code>int</code></td> <td>Number of HETATM records converted to ATOM (0 if fix_caps=False)</td> </tr> <tr> <td><code>"stdout"</code></td> <td><code>str</code></td> <td>Standard output from pdb4amber command</td> </tr> <tr> <td><code>"stderr"</code></td> <td><code>str</code></td> <td>Standard error from pdb4amber command</td> </tr> </tbody> </table> <p><strong>Raises:</strong></p> <ul> <li><code>FileNotFoundError</code> - If input PDB file doesn't exist</li> <li><code>RuntimeError</code> - If pdb4amber command fails or is not found</li> </ul> <p><strong>What This Method Does:</strong></p> <p><strong>Runs pdb4amber</strong>: Executes the AmberTools pdb4amber utility to:</p> <ul> <li>Prepare PDB structure for AMBER force field</li> <li>Remove problematic records</li> <li>Renumber atoms and residues if needed</li> </ul> <p><strong>Optionally Fixes ACE/NME Caps</strong> (if <code>fix_caps=True</code>):</p> <ul> <li>Detects ACE (N-acetyl) and NME (N-methylamide) cap residues</li> <li>Converts their HETATM records back to ATOM records</li> <li>This fixes compatibility issues with tools like packmol-memgen</li> </ul> <p><strong>The ACE/NME Cap HETATM Problem:</strong></p> <p>When protein capping is used, pdb4amber incorrectly converts cap ATOM records to HETATM:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a># Before pdb4amber (correct):
<a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a>ATOM      1  C   ACE A   1      12.640  -9.437  14.871  1.00  0.00           C
<a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a>ATOM      2  CH3 ACE A   1      12.660 -10.927  15.173  1.00  0.00           C
<a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a>
<a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a># After pdb4amber (incorrect - becomes heteroatom):
<a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a>HETATM    1  C   ACE A   1      12.640  -9.437  14.871  1.00  0.00           C
<a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a>HETATM    2  CH3 ACE A   1      12.660 -10.927  15.173  1.00  0.00           C
</code></pre></div> <p>This causes compatibility issues because:</p> <ul> <li>packmol-memgen expects caps as ATOM records</li> <li>Other MD preparation tools may skip HETATM records</li> <li>Caps should be treated as part of the protein chain</li> </ul> <p><strong>pdb4amber_options Dictionary:</strong></p> <p>You can pass custom pdb4amber command-line options:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=n>options</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a>    <span class=s2>&quot;reduce&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>        <span class=c1># Use reduce for hydrogen addition (default: True)</span>
<a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a>    <span class=s2>&quot;dry&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>          <span class=c1># Keep water molecules (default: False)</span>
<a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a>    <span class=s2>&quot;keep-altlocs&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=c1># Remove alternative locations (default: False)</span>
<a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a>    <span class=s2>&quot;strip-waters&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>  <span class=c1># Remove water molecules (default: True)</span>
<a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a><span class=p>}</span>
</code></pre></div> <p><strong>Example - Basic Usage:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a>
<a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a>
<a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=c1># Run pdb4amber with automatic cap fix (recommended for capped proteins)</span>
<a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a><span class=n>result</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>run_pdb4amber_with_cap_fix</span><span class=p>(</span>
<a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a>    <span class=n>input_pdb</span><span class=o>=</span><span class=s2>&quot;protein_capped_ph7_ss.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a>    <span class=n>output_pdb</span><span class=o>=</span><span class=s2>&quot;protein_prepared.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a>    <span class=n>fix_caps</span><span class=o>=</span><span class=kc>True</span>  <span class=c1># Default: automatically fix ACE/NME caps</span>
<a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a><span class=p>)</span>
<a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a>
<a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a><span class=k>if</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;success&#39;</span><span class=p>]:</span>
<a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ pdb4amber completed successfully&quot;</span><span class=p>)</span>
<a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Output: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;output_file&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-40-15 name=__codelineno-40-15 href=#__codelineno-40-15></a>    <span class=k>if</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;hetatm_fixed&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
<a id=__codelineno-40-16 name=__codelineno-40-16 href=#__codelineno-40-16></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Fixed </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;hetatm_fixed&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> HETATM records for ACE/NME caps&quot;</span><span class=p>)</span>
<a id=__codelineno-40-17 name=__codelineno-40-17 href=#__codelineno-40-17></a><span class=k>else</span><span class=p>:</span>
<a id=__codelineno-40-18 name=__codelineno-40-18 href=#__codelineno-40-18></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✗ pdb4amber failed&quot;</span><span class=p>)</span>
<a id=__codelineno-40-19 name=__codelineno-40-19 href=#__codelineno-40-19></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;stderr&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div> <p><strong>Example - Without Cap Fix:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a>
<a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a>
<a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a><span class=c1># Run pdb4amber without cap fix (for uncapped proteins)</span>
<a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=n>result</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>run_pdb4amber_with_cap_fix</span><span class=p>(</span>
<a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a>    <span class=n>input_pdb</span><span class=o>=</span><span class=s2>&quot;protein_uncapped_ph7_ss.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a>    <span class=n>output_pdb</span><span class=o>=</span><span class=s2>&quot;protein_prepared.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a>    <span class=n>fix_caps</span><span class=o>=</span><span class=kc>False</span>  <span class=c1># No cap fix needed</span>
<a id=__codelineno-41-10 name=__codelineno-41-10 href=#__codelineno-41-10></a><span class=p>)</span>
<a id=__codelineno-41-11 name=__codelineno-41-11 href=#__codelineno-41-11></a>
<a id=__codelineno-41-12 name=__codelineno-41-12 href=#__codelineno-41-12></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Success: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;success&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-41-13 name=__codelineno-41-13 href=#__codelineno-41-13></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;HETATM records fixed: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;hetatm_fixed&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>  <span class=c1># Will be 0</span>
</code></pre></div> <p><strong>Example - With Custom pdb4amber Options:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a>
<a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a>
<a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a><span class=c1># Run with custom pdb4amber options</span>
<a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a><span class=n>custom_options</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a>    <span class=s2>&quot;dry&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>          <span class=c1># Keep crystallographic waters</span>
<a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a>    <span class=s2>&quot;keep-altlocs&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>  <span class=c1># Keep alternative locations</span>
<a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a><span class=p>}</span>
<a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a>
<a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a><span class=n>result</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>run_pdb4amber_with_cap_fix</span><span class=p>(</span>
<a id=__codelineno-42-12 name=__codelineno-42-12 href=#__codelineno-42-12></a>    <span class=n>input_pdb</span><span class=o>=</span><span class=s2>&quot;protein_capped_ph7_ss.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-42-13 name=__codelineno-42-13 href=#__codelineno-42-13></a>    <span class=n>output_pdb</span><span class=o>=</span><span class=s2>&quot;protein_prepared.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-42-14 name=__codelineno-42-14 href=#__codelineno-42-14></a>    <span class=n>fix_caps</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-42-15 name=__codelineno-42-15 href=#__codelineno-42-15></a>    <span class=n>pdb4amber_options</span><span class=o>=</span><span class=n>custom_options</span>
<a id=__codelineno-42-16 name=__codelineno-42-16 href=#__codelineno-42-16></a><span class=p>)</span>
<a id=__codelineno-42-17 name=__codelineno-42-17 href=#__codelineno-42-17></a>
<a id=__codelineno-42-18 name=__codelineno-42-18 href=#__codelineno-42-18></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;pdb4amber output:</span><span class=se>\n</span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;stdout&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div> <p><strong>Integration with Complete Workflow:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.utils.protein_capping</span><span class=w> </span><span class=kn>import</span> <span class=n>ProteinCapper</span>
<a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a>
<a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=c1># Step 1: Add caps</span>
<a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=n>capper</span> <span class=o>=</span> <span class=n>ProteinCapper</span><span class=p>()</span>
<a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a><span class=n>capped_file</span><span class=p>,</span> <span class=n>mapping</span> <span class=o>=</span> <span class=n>capper</span><span class=o>.</span><span class=n>remove_hydrogens_and_cap</span><span class=p>(</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>)</span>
<a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a>
<a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a><span class=c1># Step 2: Run Propka analysis</span>
<a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a><span class=n>pka_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>run_analysis</span><span class=p>(</span><span class=n>capped_file</span><span class=p>)</span>
<a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a><span class=n>summary_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>extract_summary</span><span class=p>(</span><span class=n>pka_file</span><span class=p>)</span>
<a id=__codelineno-43-12 name=__codelineno-43-12 href=#__codelineno-43-12></a><span class=n>residues</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>parse_summary</span><span class=p>(</span><span class=n>summary_file</span><span class=p>)</span>
<a id=__codelineno-43-13 name=__codelineno-43-13 href=#__codelineno-43-13></a>
<a id=__codelineno-43-14 name=__codelineno-43-14 href=#__codelineno-43-14></a><span class=c1># Step 3: Apply protonation states</span>
<a id=__codelineno-43-15 name=__codelineno-43-15 href=#__codelineno-43-15></a><span class=n>analyzer</span><span class=o>.</span><span class=n>apply_protonation_states</span><span class=p>(</span>
<a id=__codelineno-43-16 name=__codelineno-43-16 href=#__codelineno-43-16></a>    <span class=n>input_pdb</span><span class=o>=</span><span class=n>capped_file</span><span class=p>,</span>
<a id=__codelineno-43-17 name=__codelineno-43-17 href=#__codelineno-43-17></a>    <span class=n>output_pdb</span><span class=o>=</span><span class=s2>&quot;protein_capped_ph7.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-43-18 name=__codelineno-43-18 href=#__codelineno-43-18></a>    <span class=n>ph</span><span class=o>=</span><span class=mf>7.4</span><span class=p>,</span>
<a id=__codelineno-43-19 name=__codelineno-43-19 href=#__codelineno-43-19></a>    <span class=n>residues</span><span class=o>=</span><span class=n>residues</span>
<a id=__codelineno-43-20 name=__codelineno-43-20 href=#__codelineno-43-20></a><span class=p>)</span>
<a id=__codelineno-43-21 name=__codelineno-43-21 href=#__codelineno-43-21></a>
<a id=__codelineno-43-22 name=__codelineno-43-22 href=#__codelineno-43-22></a><span class=c1># Step 4: Apply disulfide bonds</span>
<a id=__codelineno-43-23 name=__codelineno-43-23 href=#__codelineno-43-23></a><span class=n>bonds</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>detect_disulfide_bonds</span><span class=p>(</span><span class=n>capped_file</span><span class=p>)</span>
<a id=__codelineno-43-24 name=__codelineno-43-24 href=#__codelineno-43-24></a><span class=n>analyzer</span><span class=o>.</span><span class=n>apply_disulfide_bonds</span><span class=p>(</span>
<a id=__codelineno-43-25 name=__codelineno-43-25 href=#__codelineno-43-25></a>    <span class=n>input_pdb</span><span class=o>=</span><span class=s2>&quot;protein_capped_ph7.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-43-26 name=__codelineno-43-26 href=#__codelineno-43-26></a>    <span class=n>output_pdb</span><span class=o>=</span><span class=s2>&quot;protein_capped_ph7_ss.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-43-27 name=__codelineno-43-27 href=#__codelineno-43-27></a>    <span class=n>disulfide_bonds</span><span class=o>=</span><span class=n>bonds</span>
<a id=__codelineno-43-28 name=__codelineno-43-28 href=#__codelineno-43-28></a><span class=p>)</span>
<a id=__codelineno-43-29 name=__codelineno-43-29 href=#__codelineno-43-29></a>
<a id=__codelineno-43-30 name=__codelineno-43-30 href=#__codelineno-43-30></a><span class=c1># Step 5: Run pdb4amber with automatic cap fix</span>
<a id=__codelineno-43-31 name=__codelineno-43-31 href=#__codelineno-43-31></a><span class=n>result</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>run_pdb4amber_with_cap_fix</span><span class=p>(</span>
<a id=__codelineno-43-32 name=__codelineno-43-32 href=#__codelineno-43-32></a>    <span class=n>input_pdb</span><span class=o>=</span><span class=s2>&quot;protein_capped_ph7_ss.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-43-33 name=__codelineno-43-33 href=#__codelineno-43-33></a>    <span class=n>output_pdb</span><span class=o>=</span><span class=s2>&quot;protein_prepared.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-43-34 name=__codelineno-43-34 href=#__codelineno-43-34></a>    <span class=n>fix_caps</span><span class=o>=</span><span class=kc>True</span>  <span class=c1># Critical for capped proteins!</span>
<a id=__codelineno-43-35 name=__codelineno-43-35 href=#__codelineno-43-35></a><span class=p>)</span>
<a id=__codelineno-43-36 name=__codelineno-43-36 href=#__codelineno-43-36></a>
<a id=__codelineno-43-37 name=__codelineno-43-37 href=#__codelineno-43-37></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Final AMBER-ready structure: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;output_file&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div> <p><strong>GUI Behavior:</strong></p> <p>When using the GUI:</p> <ul> <li>The "Apply States &amp; Run pdb4amber" button automatically uses this method</li> <li>Automatically detects when capping was used (checks capping checkbox)</li> <li>Sets <code>fix_caps=True</code> if capping was applied</li> <li>Reports number of fixed HETATM records in success message</li> <li>Displays pdb4amber output in the GUI log</li> </ul> <p><strong>Important Notes:</strong></p> <p>⚠️ <strong>When to use fix_caps=True:</strong></p> <ul> <li>When you used protein capping (ACE/NME groups added)</li> <li>When planning to use packmol-memgen or similar tools</li> <li>When you need caps to be part of the protein chain (ATOM records)</li> </ul> <p>⚠️ <strong>When to use fix_caps=False:</strong></p> <ul> <li>When no capping was applied</li> <li>When you want standard pdb4amber behavior</li> <li>When working with uncapped protein structures</li> </ul> <p>⚠️ <strong>Requirements:</strong></p> <ul> <li>Requires AmberTools installation (pdb4amber command must be available)</li> <li>Input PDB should already have correct protonation states and disulfide bonds applied</li> </ul> <hr> <h2 id=complete-workflow-examples>Complete Workflow Examples<a class=headerlink href=#complete-workflow-examples title="Permanent link">&para;</a></h2> <h3 id=advanced-workflow-with-protonation-and-disulfide-bonds>Advanced Workflow with Protonation and Disulfide Bonds<a class=headerlink href=#advanced-workflow-with-protonation-and-disulfide-bonds title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a>
<a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a>
<a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a><span class=c1># Step 1: Run Propka analysis</span>
<a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a><span class=n>pka_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>run_analysis</span><span class=p>(</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>,</span> <span class=n>output_dir</span><span class=o>=</span><span class=s2>&quot;output&quot;</span><span class=p>)</span>
<a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a><span class=n>summary_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>extract_summary</span><span class=p>(</span><span class=n>pka_file</span><span class=p>,</span> <span class=n>output_dir</span><span class=o>=</span><span class=s2>&quot;output&quot;</span><span class=p>)</span>
<a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a><span class=n>residues</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>parse_summary</span><span class=p>(</span><span class=n>summary_file</span><span class=p>)</span>
<a id=__codelineno-44-9 name=__codelineno-44-9 href=#__codelineno-44-9></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Found </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>residues</span><span class=p>)</span><span class=si>}</span><span class=s2> ionizable residues&quot;</span><span class=p>)</span>
<a id=__codelineno-44-10 name=__codelineno-44-10 href=#__codelineno-44-10></a>
<a id=__codelineno-44-11 name=__codelineno-44-11 href=#__codelineno-44-11></a><span class=c1># Step 2: Detect disulfide bonds</span>
<a id=__codelineno-44-12 name=__codelineno-44-12 href=#__codelineno-44-12></a><span class=n>bonds</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>detect_disulfide_bonds</span><span class=p>(</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>,</span> <span class=n>distance_threshold</span><span class=o>=</span><span class=mf>2.5</span><span class=p>)</span>
<a id=__codelineno-44-13 name=__codelineno-44-13 href=#__codelineno-44-13></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Detected </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>bonds</span><span class=p>)</span><span class=si>}</span><span class=s2> disulfide bonds&quot;</span><span class=p>)</span>
<a id=__codelineno-44-14 name=__codelineno-44-14 href=#__codelineno-44-14></a>
<a id=__codelineno-44-15 name=__codelineno-44-15 href=#__codelineno-44-15></a><span class=c1># Step 3: Apply protonation states</span>
<a id=__codelineno-44-16 name=__codelineno-44-16 href=#__codelineno-44-16></a><span class=n>stats</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>apply_protonation_states</span><span class=p>(</span>
<a id=__codelineno-44-17 name=__codelineno-44-17 href=#__codelineno-44-17></a>    <span class=n>input_pdb</span><span class=o>=</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-44-18 name=__codelineno-44-18 href=#__codelineno-44-18></a>    <span class=n>output_pdb</span><span class=o>=</span><span class=s2>&quot;output/protein_ph7.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-44-19 name=__codelineno-44-19 href=#__codelineno-44-19></a>    <span class=n>ph</span><span class=o>=</span><span class=mf>7.4</span><span class=p>,</span>
<a id=__codelineno-44-20 name=__codelineno-44-20 href=#__codelineno-44-20></a>    <span class=n>residues</span><span class=o>=</span><span class=n>residues</span>
<a id=__codelineno-44-21 name=__codelineno-44-21 href=#__codelineno-44-21></a><span class=p>)</span>
<a id=__codelineno-44-22 name=__codelineno-44-22 href=#__codelineno-44-22></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Protonation: </span><span class=si>{</span><span class=n>stats</span><span class=p>[</span><span class=s1>&#39;residue_changes&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> residues, &quot;</span>
<a id=__codelineno-44-23 name=__codelineno-44-23 href=#__codelineno-44-23></a>      <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>stats</span><span class=p>[</span><span class=s1>&#39;record_changes&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> PDB records changed&quot;</span><span class=p>)</span>
<a id=__codelineno-44-24 name=__codelineno-44-24 href=#__codelineno-44-24></a>
<a id=__codelineno-44-25 name=__codelineno-44-25 href=#__codelineno-44-25></a><span class=c1># Step 4: Apply disulfide bonds</span>
<a id=__codelineno-44-26 name=__codelineno-44-26 href=#__codelineno-44-26></a><span class=n>num_bonds</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>apply_disulfide_bonds</span><span class=p>(</span>
<a id=__codelineno-44-27 name=__codelineno-44-27 href=#__codelineno-44-27></a>    <span class=n>input_pdb</span><span class=o>=</span><span class=s2>&quot;output/protein_ph7.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-44-28 name=__codelineno-44-28 href=#__codelineno-44-28></a>    <span class=n>output_pdb</span><span class=o>=</span><span class=s2>&quot;output/protein_ph7_ss.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-44-29 name=__codelineno-44-29 href=#__codelineno-44-29></a>    <span class=n>disulfide_bonds</span><span class=o>=</span><span class=n>bonds</span><span class=p>,</span>
<a id=__codelineno-44-30 name=__codelineno-44-30 href=#__codelineno-44-30></a>    <span class=n>auto_detect</span><span class=o>=</span><span class=kc>False</span>
<a id=__codelineno-44-31 name=__codelineno-44-31 href=#__codelineno-44-31></a><span class=p>)</span>
<a id=__codelineno-44-32 name=__codelineno-44-32 href=#__codelineno-44-32></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Applied </span><span class=si>{</span><span class=n>num_bonds</span><span class=si>}</span><span class=s2> disulfide bonds (CYS → CYX)&quot;</span><span class=p>)</span>
</code></pre></div> <h3 id=workflow-with-protein-capping>Workflow with Protein Capping<a class=headerlink href=#workflow-with-protein-capping title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.utils.protein_capping</span><span class=w> </span><span class=kn>import</span> <span class=n>ProteinCapper</span>
<a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a>
<a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a><span class=c1># Step 1: Add ACE/NME caps</span>
<a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=n>capper</span> <span class=o>=</span> <span class=n>ProteinCapper</span><span class=p>()</span>
<a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a><span class=n>capped_file</span><span class=p>,</span> <span class=n>residue_mapping</span> <span class=o>=</span> <span class=n>capper</span><span class=o>.</span><span class=n>remove_hydrogens_and_cap</span><span class=p>(</span>
<a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a>    <span class=n>input_file</span><span class=o>=</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a>    <span class=n>output_file</span><span class=o>=</span><span class=s2>&quot;protein_capped.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a>    <span class=n>target_dir</span><span class=o>=</span><span class=s2>&quot;output&quot;</span>
<a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a><span class=p>)</span>
<a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Capped protein: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>residue_mapping</span><span class=p>)</span><span class=si>}</span><span class=s2> residues tracked&quot;</span><span class=p>)</span>
<a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a>
<a id=__codelineno-45-13 name=__codelineno-45-13 href=#__codelineno-45-13></a><span class=c1># Step 2: Run Propka on capped structure</span>
<a id=__codelineno-45-14 name=__codelineno-45-14 href=#__codelineno-45-14></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-45-15 name=__codelineno-45-15 href=#__codelineno-45-15></a><span class=n>pka_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>run_analysis</span><span class=p>(</span><span class=n>capped_file</span><span class=p>,</span> <span class=n>output_dir</span><span class=o>=</span><span class=s2>&quot;output&quot;</span><span class=p>)</span>
<a id=__codelineno-45-16 name=__codelineno-45-16 href=#__codelineno-45-16></a><span class=n>summary_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>extract_summary</span><span class=p>(</span><span class=n>pka_file</span><span class=p>,</span> <span class=n>output_dir</span><span class=o>=</span><span class=s2>&quot;output&quot;</span><span class=p>)</span>
<a id=__codelineno-45-17 name=__codelineno-45-17 href=#__codelineno-45-17></a><span class=n>residues</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>parse_summary</span><span class=p>(</span><span class=n>summary_file</span><span class=p>)</span>
<a id=__codelineno-45-18 name=__codelineno-45-18 href=#__codelineno-45-18></a>
<a id=__codelineno-45-19 name=__codelineno-45-19 href=#__codelineno-45-19></a><span class=c1># Step 3: Detect disulfide bonds</span>
<a id=__codelineno-45-20 name=__codelineno-45-20 href=#__codelineno-45-20></a><span class=n>bonds</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>detect_disulfide_bonds</span><span class=p>(</span><span class=n>capped_file</span><span class=p>)</span>
<a id=__codelineno-45-21 name=__codelineno-45-21 href=#__codelineno-45-21></a>
<a id=__codelineno-45-22 name=__codelineno-45-22 href=#__codelineno-45-22></a><span class=c1># Step 4: Apply protonation</span>
<a id=__codelineno-45-23 name=__codelineno-45-23 href=#__codelineno-45-23></a><span class=n>stats</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>apply_protonation_states</span><span class=p>(</span>
<a id=__codelineno-45-24 name=__codelineno-45-24 href=#__codelineno-45-24></a>    <span class=n>input_pdb</span><span class=o>=</span><span class=n>capped_file</span><span class=p>,</span>
<a id=__codelineno-45-25 name=__codelineno-45-25 href=#__codelineno-45-25></a>    <span class=n>output_pdb</span><span class=o>=</span><span class=s2>&quot;output/protein_capped_ph7.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-45-26 name=__codelineno-45-26 href=#__codelineno-45-26></a>    <span class=n>ph</span><span class=o>=</span><span class=mf>7.4</span><span class=p>,</span>
<a id=__codelineno-45-27 name=__codelineno-45-27 href=#__codelineno-45-27></a>    <span class=n>residues</span><span class=o>=</span><span class=n>residues</span>
<a id=__codelineno-45-28 name=__codelineno-45-28 href=#__codelineno-45-28></a><span class=p>)</span>
<a id=__codelineno-45-29 name=__codelineno-45-29 href=#__codelineno-45-29></a>
<a id=__codelineno-45-30 name=__codelineno-45-30 href=#__codelineno-45-30></a><span class=c1># Step 5: Apply disulfide bonds</span>
<a id=__codelineno-45-31 name=__codelineno-45-31 href=#__codelineno-45-31></a><span class=n>num_bonds</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>apply_disulfide_bonds</span><span class=p>(</span>
<a id=__codelineno-45-32 name=__codelineno-45-32 href=#__codelineno-45-32></a>    <span class=n>input_pdb</span><span class=o>=</span><span class=s2>&quot;output/protein_capped_ph7.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-45-33 name=__codelineno-45-33 href=#__codelineno-45-33></a>    <span class=n>output_pdb</span><span class=o>=</span><span class=s2>&quot;output/protein_capped_ph7_ss.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-45-34 name=__codelineno-45-34 href=#__codelineno-45-34></a>    <span class=n>disulfide_bonds</span><span class=o>=</span><span class=n>bonds</span><span class=p>,</span>
<a id=__codelineno-45-35 name=__codelineno-45-35 href=#__codelineno-45-35></a>    <span class=n>auto_detect</span><span class=o>=</span><span class=kc>False</span>
<a id=__codelineno-45-36 name=__codelineno-45-36 href=#__codelineno-45-36></a><span class=p>)</span>
<a id=__codelineno-45-37 name=__codelineno-45-37 href=#__codelineno-45-37></a>
<a id=__codelineno-45-38 name=__codelineno-45-38 href=#__codelineno-45-38></a><span class=c1># Step 6: Run pdb4amber with automatic ACE/NME HETATM fix</span>
<a id=__codelineno-45-39 name=__codelineno-45-39 href=#__codelineno-45-39></a><span class=n>result</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>run_pdb4amber_with_cap_fix</span><span class=p>(</span>
<a id=__codelineno-45-40 name=__codelineno-45-40 href=#__codelineno-45-40></a>    <span class=n>input_pdb</span><span class=o>=</span><span class=s2>&quot;output/protein_capped_ph7_ss.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-45-41 name=__codelineno-45-41 href=#__codelineno-45-41></a>    <span class=n>output_pdb</span><span class=o>=</span><span class=s2>&quot;output/protein_prepared.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-45-42 name=__codelineno-45-42 href=#__codelineno-45-42></a>    <span class=n>fix_caps</span><span class=o>=</span><span class=kc>True</span>  <span class=c1># Automatically fix ACE/NME HETATM records</span>
<a id=__codelineno-45-43 name=__codelineno-45-43 href=#__codelineno-45-43></a><span class=p>)</span>
<a id=__codelineno-45-44 name=__codelineno-45-44 href=#__codelineno-45-44></a>
<a id=__codelineno-45-45 name=__codelineno-45-45 href=#__codelineno-45-45></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ pdb4amber completed: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;output_file&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-45-46 name=__codelineno-45-46 href=#__codelineno-45-46></a><span class=k>if</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;hetatm_fixed&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
<a id=__codelineno-45-47 name=__codelineno-45-47 href=#__codelineno-45-47></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Fixed </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;hetatm_fixed&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> HETATM records for ACE/NME caps&quot;</span><span class=p>)</span>
<a id=__codelineno-45-48 name=__codelineno-45-48 href=#__codelineno-45-48></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Final structure ready: protein_prepared.pdb&quot;</span><span class=p>)</span>
</code></pre></div> <h3 id=multiple-ph-variants>Multiple pH Variants<a class=headerlink href=#multiple-ph-variants title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a>
<a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a>
<a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a><span class=c1># Run analysis once</span>
<a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a><span class=n>pka_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>run_analysis</span><span class=p>(</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>,</span> <span class=n>output_dir</span><span class=o>=</span><span class=s2>&quot;output&quot;</span><span class=p>)</span>
<a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a><span class=n>summary_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>extract_summary</span><span class=p>(</span><span class=n>pka_file</span><span class=p>,</span> <span class=n>output_dir</span><span class=o>=</span><span class=s2>&quot;output&quot;</span><span class=p>)</span>
<a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a><span class=n>residues</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>parse_summary</span><span class=p>(</span><span class=n>summary_file</span><span class=p>)</span>
<a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a><span class=n>bonds</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>detect_disulfide_bonds</span><span class=p>(</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>)</span>
<a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a>
<a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a><span class=c1># Generate structures for different pH values</span>
<a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a><span class=k>for</span> <span class=n>ph</span> <span class=ow>in</span> <span class=p>[</span><span class=mf>5.0</span><span class=p>,</span> <span class=mf>6.0</span><span class=p>,</span> <span class=mf>7.0</span><span class=p>,</span> <span class=mf>7.4</span><span class=p>,</span> <span class=mf>8.0</span><span class=p>,</span> <span class=mf>9.0</span><span class=p>]:</span>
<a id=__codelineno-46-13 name=__codelineno-46-13 href=#__codelineno-46-13></a>    <span class=c1># Apply protonation</span>
<a id=__codelineno-46-14 name=__codelineno-46-14 href=#__codelineno-46-14></a>    <span class=n>stats</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>apply_protonation_states</span><span class=p>(</span>
<a id=__codelineno-46-15 name=__codelineno-46-15 href=#__codelineno-46-15></a>        <span class=n>input_pdb</span><span class=o>=</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-46-16 name=__codelineno-46-16 href=#__codelineno-46-16></a>        <span class=n>output_pdb</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;output/protein_ph</span><span class=si>{</span><span class=n>ph</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-46-17 name=__codelineno-46-17 href=#__codelineno-46-17></a>        <span class=n>ph</span><span class=o>=</span><span class=n>ph</span><span class=p>,</span>
<a id=__codelineno-46-18 name=__codelineno-46-18 href=#__codelineno-46-18></a>        <span class=n>residues</span><span class=o>=</span><span class=n>residues</span>
<a id=__codelineno-46-19 name=__codelineno-46-19 href=#__codelineno-46-19></a>    <span class=p>)</span>
<a id=__codelineno-46-20 name=__codelineno-46-20 href=#__codelineno-46-20></a>
<a id=__codelineno-46-21 name=__codelineno-46-21 href=#__codelineno-46-21></a>    <span class=c1># Apply disulfide bonds</span>
<a id=__codelineno-46-22 name=__codelineno-46-22 href=#__codelineno-46-22></a>    <span class=n>analyzer</span><span class=o>.</span><span class=n>apply_disulfide_bonds</span><span class=p>(</span>
<a id=__codelineno-46-23 name=__codelineno-46-23 href=#__codelineno-46-23></a>        <span class=n>input_pdb</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;output/protein_ph</span><span class=si>{</span><span class=n>ph</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-46-24 name=__codelineno-46-24 href=#__codelineno-46-24></a>        <span class=n>output_pdb</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;output/protein_ph</span><span class=si>{</span><span class=n>ph</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>_ss.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-46-25 name=__codelineno-46-25 href=#__codelineno-46-25></a>        <span class=n>disulfide_bonds</span><span class=o>=</span><span class=n>bonds</span><span class=p>,</span>
<a id=__codelineno-46-26 name=__codelineno-46-26 href=#__codelineno-46-26></a>        <span class=n>auto_detect</span><span class=o>=</span><span class=kc>False</span>
<a id=__codelineno-46-27 name=__codelineno-46-27 href=#__codelineno-46-27></a>    <span class=p>)</span>
<a id=__codelineno-46-28 name=__codelineno-46-28 href=#__codelineno-46-28></a>
<a id=__codelineno-46-29 name=__codelineno-46-29 href=#__codelineno-46-29></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;pH </span><span class=si>{</span><span class=n>ph</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>stats</span><span class=p>[</span><span class=s1>&#39;residue_changes&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> residues modified, &quot;</span>
<a id=__codelineno-46-30 name=__codelineno-46-30 href=#__codelineno-46-30></a>          <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>bonds</span><span class=p>)</span><span class=si>}</span><span class=s2> S-S bonds&quot;</span><span class=p>)</span>
</code></pre></div> <hr> <h2 id=advanced-topics>Advanced Topics<a class=headerlink href=#advanced-topics title="Permanent link">&para;</a></h2> <h3 id=residue-mapping-after-capping>Residue Mapping After Capping<a class=headerlink href=#residue-mapping-after-capping title="Permanent link">&para;</a></h3> <p>When proteins are capped, residue numbers change (all shift by +1). Use the mapping dictionary to translate:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=kn>import</span><span class=w> </span><span class=nn>re</span>
<a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.utils.protein_capping</span><span class=w> </span><span class=kn>import</span> <span class=n>ProteinCapper</span>
<a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a>
<a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a><span class=c1># Step 1: Add ACE/NME caps to get residue mapping</span>
<a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a><span class=n>capper</span> <span class=o>=</span> <span class=n>ProteinCapper</span><span class=p>()</span>
<a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a><span class=n>capped_file</span><span class=p>,</span> <span class=n>residue_mapping</span> <span class=o>=</span> <span class=n>capper</span><span class=o>.</span><span class=n>remove_hydrogens_and_cap</span><span class=p>(</span>
<a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a>    <span class=n>input_file</span><span class=o>=</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a>    <span class=n>output_file</span><span class=o>=</span><span class=s2>&quot;protein_capped.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a>    <span class=n>target_dir</span><span class=o>=</span><span class=s2>&quot;output&quot;</span>
<a id=__codelineno-47-11 name=__codelineno-47-11 href=#__codelineno-47-11></a><span class=p>)</span>
<a id=__codelineno-47-12 name=__codelineno-47-12 href=#__codelineno-47-12></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Capped protein with </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>residue_mapping</span><span class=p>)</span><span class=si>}</span><span class=s2> residues tracked&quot;</span><span class=p>)</span>
<a id=__codelineno-47-13 name=__codelineno-47-13 href=#__codelineno-47-13></a>
<a id=__codelineno-47-14 name=__codelineno-47-14 href=#__codelineno-47-14></a><span class=c1># Step 2: Run Propka analysis on capped structure</span>
<a id=__codelineno-47-15 name=__codelineno-47-15 href=#__codelineno-47-15></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-47-16 name=__codelineno-47-16 href=#__codelineno-47-16></a><span class=n>pka_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>run_analysis</span><span class=p>(</span><span class=n>capped_file</span><span class=p>,</span> <span class=n>output_dir</span><span class=o>=</span><span class=s2>&quot;output&quot;</span><span class=p>)</span>
<a id=__codelineno-47-17 name=__codelineno-47-17 href=#__codelineno-47-17></a><span class=n>summary_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>extract_summary</span><span class=p>(</span><span class=n>pka_file</span><span class=p>,</span> <span class=n>output_dir</span><span class=o>=</span><span class=s2>&quot;output&quot;</span><span class=p>)</span>
<a id=__codelineno-47-18 name=__codelineno-47-18 href=#__codelineno-47-18></a><span class=n>residues</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>parse_summary</span><span class=p>(</span><span class=n>summary_file</span><span class=p>)</span>
<a id=__codelineno-47-19 name=__codelineno-47-19 href=#__codelineno-47-19></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Analyzed </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>residues</span><span class=p>)</span><span class=si>}</span><span class=s2> ionizable residues&quot;</span><span class=p>)</span>
<a id=__codelineno-47-20 name=__codelineno-47-20 href=#__codelineno-47-20></a>
<a id=__codelineno-47-21 name=__codelineno-47-21 href=#__codelineno-47-21></a><span class=c1># Step 3: Define custom states using ORIGINAL (uncapped) numbering</span>
<a id=__codelineno-47-22 name=__codelineno-47-22 href=#__codelineno-47-22></a><span class=n>original_custom_states</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-47-23 name=__codelineno-47-23 href=#__codelineno-47-23></a>    <span class=s2>&quot;ASP12&quot;</span><span class=p>:</span> <span class=s2>&quot;ASH&quot;</span><span class=p>,</span>  <span class=c1># Force protonate ASP at original position 12</span>
<a id=__codelineno-47-24 name=__codelineno-47-24 href=#__codelineno-47-24></a>    <span class=s2>&quot;GLU13&quot;</span><span class=p>:</span> <span class=s2>&quot;GLH&quot;</span>   <span class=c1># Force protonate GLU at original position 13</span>
<a id=__codelineno-47-25 name=__codelineno-47-25 href=#__codelineno-47-25></a><span class=p>}</span>
<a id=__codelineno-47-26 name=__codelineno-47-26 href=#__codelineno-47-26></a>
<a id=__codelineno-47-27 name=__codelineno-47-27 href=#__codelineno-47-27></a><span class=c1># Step 4: Translate to NEW numbering after capping (all shifted by +1)</span>
<a id=__codelineno-47-28 name=__codelineno-47-28 href=#__codelineno-47-28></a><span class=n>custom_states_new</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-47-29 name=__codelineno-47-29 href=#__codelineno-47-29></a><span class=k>for</span> <span class=n>orig_spec</span><span class=p>,</span> <span class=n>state</span> <span class=ow>in</span> <span class=n>original_custom_states</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<a id=__codelineno-47-30 name=__codelineno-47-30 href=#__codelineno-47-30></a>    <span class=n>match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>match</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;([A-Z]+)(\d+)(?:_([A-Z]))?&#39;</span><span class=p>,</span> <span class=n>orig_spec</span><span class=p>)</span>
<a id=__codelineno-47-31 name=__codelineno-47-31 href=#__codelineno-47-31></a>    <span class=k>if</span> <span class=n>match</span><span class=p>:</span>
<a id=__codelineno-47-32 name=__codelineno-47-32 href=#__codelineno-47-32></a>        <span class=n>resname</span><span class=p>,</span> <span class=n>resid</span><span class=p>,</span> <span class=n>chain</span> <span class=o>=</span> <span class=n>match</span><span class=o>.</span><span class=n>groups</span><span class=p>()</span>
<a id=__codelineno-47-33 name=__codelineno-47-33 href=#__codelineno-47-33></a>        <span class=n>resid</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>resid</span><span class=p>)</span>
<a id=__codelineno-47-34 name=__codelineno-47-34 href=#__codelineno-47-34></a>        <span class=n>chain</span> <span class=o>=</span> <span class=n>chain</span> <span class=ow>or</span> <span class=s2>&quot;A&quot;</span>
<a id=__codelineno-47-35 name=__codelineno-47-35 href=#__codelineno-47-35></a>
<a id=__codelineno-47-36 name=__codelineno-47-36 href=#__codelineno-47-36></a>        <span class=c1># Look up the new numbering from mapping</span>
<a id=__codelineno-47-37 name=__codelineno-47-37 href=#__codelineno-47-37></a>        <span class=n>original_key</span> <span class=o>=</span> <span class=p>(</span><span class=n>resname</span><span class=p>,</span> <span class=n>chain</span><span class=p>,</span> <span class=n>resid</span><span class=p>)</span>
<a id=__codelineno-47-38 name=__codelineno-47-38 href=#__codelineno-47-38></a>        <span class=k>if</span> <span class=n>original_key</span> <span class=ow>in</span> <span class=n>residue_mapping</span><span class=p>:</span>
<a id=__codelineno-47-39 name=__codelineno-47-39 href=#__codelineno-47-39></a>            <span class=n>new_resname</span><span class=p>,</span> <span class=n>new_chain</span><span class=p>,</span> <span class=n>new_resid</span> <span class=o>=</span> <span class=n>residue_mapping</span><span class=p>[</span><span class=n>original_key</span><span class=p>]</span>
<a id=__codelineno-47-40 name=__codelineno-47-40 href=#__codelineno-47-40></a>            <span class=n>new_spec</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>new_resname</span><span class=si>}{</span><span class=n>new_resid</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>new_chain</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-47-41 name=__codelineno-47-41 href=#__codelineno-47-41></a>            <span class=n>custom_states_new</span><span class=p>[</span><span class=n>new_spec</span><span class=p>]</span> <span class=o>=</span> <span class=n>state</span>
<a id=__codelineno-47-42 name=__codelineno-47-42 href=#__codelineno-47-42></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  Mapped </span><span class=si>{</span><span class=n>orig_spec</span><span class=si>}</span><span class=s2> → </span><span class=si>{</span><span class=n>new_spec</span><span class=si>}</span><span class=s2> (</span><span class=si>{</span><span class=n>state</span><span class=si>}</span><span class=s2>)&quot;</span><span class=p>)</span>
<a id=__codelineno-47-43 name=__codelineno-47-43 href=#__codelineno-47-43></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-47-44 name=__codelineno-47-44 href=#__codelineno-47-44></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  Warning: </span><span class=si>{</span><span class=n>orig_spec</span><span class=si>}</span><span class=s2> not found in mapping&quot;</span><span class=p>)</span>
<a id=__codelineno-47-45 name=__codelineno-47-45 href=#__codelineno-47-45></a>
<a id=__codelineno-47-46 name=__codelineno-47-46 href=#__codelineno-47-46></a><span class=c1># Step 5: Apply protonation states using the TRANSLATED custom states</span>
<a id=__codelineno-47-47 name=__codelineno-47-47 href=#__codelineno-47-47></a><span class=n>stats</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>apply_protonation_states</span><span class=p>(</span>
<a id=__codelineno-47-48 name=__codelineno-47-48 href=#__codelineno-47-48></a>    <span class=n>input_pdb</span><span class=o>=</span><span class=n>capped_file</span><span class=p>,</span>
<a id=__codelineno-47-49 name=__codelineno-47-49 href=#__codelineno-47-49></a>    <span class=n>output_pdb</span><span class=o>=</span><span class=s2>&quot;output/protein_capped_custom.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-47-50 name=__codelineno-47-50 href=#__codelineno-47-50></a>    <span class=n>ph</span><span class=o>=</span><span class=mf>7.4</span><span class=p>,</span>
<a id=__codelineno-47-51 name=__codelineno-47-51 href=#__codelineno-47-51></a>    <span class=n>custom_states</span><span class=o>=</span><span class=n>custom_states_new</span><span class=p>,</span>  <span class=c1># Use translated states</span>
<a id=__codelineno-47-52 name=__codelineno-47-52 href=#__codelineno-47-52></a>    <span class=n>residues</span><span class=o>=</span><span class=n>residues</span>
<a id=__codelineno-47-53 name=__codelineno-47-53 href=#__codelineno-47-53></a><span class=p>)</span>
<a id=__codelineno-47-54 name=__codelineno-47-54 href=#__codelineno-47-54></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Applied protonation: </span><span class=si>{</span><span class=n>stats</span><span class=p>[</span><span class=s1>&#39;residue_changes&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> residues modified&quot;</span><span class=p>)</span>
</code></pre></div> <p><strong>Example Output:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a>✓ Capped protein with 50 residues tracked
<a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a>✓ Analyzed 12 ionizable residues
<a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a>  Mapped ASP12 → ASP13_A (ASH)
<a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a>  Mapped GLU13 → GLU14_A (GLH)
<a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a>✓ Applied protonation: 12 residues modified
</code></pre></div></p> <h3 id=custom-protonation-states>Custom Protonation States<a class=headerlink href=#custom-protonation-states title="Permanent link">&para;</a></h3> <p>Override automatic pH-based protonation with custom states for specific residues:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a>
<a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class=c1># Step 1: Run standard Propka workflow</span>
<a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a><span class=n>pka_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>run_analysis</span><span class=p>(</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>,</span> <span class=n>output_dir</span><span class=o>=</span><span class=s2>&quot;output&quot;</span><span class=p>)</span>
<a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a><span class=n>summary_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>extract_summary</span><span class=p>(</span><span class=n>pka_file</span><span class=p>,</span> <span class=n>output_dir</span><span class=o>=</span><span class=s2>&quot;output&quot;</span><span class=p>)</span>
<a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a><span class=n>residues</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>parse_summary</span><span class=p>(</span><span class=n>summary_file</span><span class=p>)</span>
<a id=__codelineno-49-8 name=__codelineno-49-8 href=#__codelineno-49-8></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Analyzed </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>residues</span><span class=p>)</span><span class=si>}</span><span class=s2> ionizable residues&quot;</span><span class=p>)</span>
<a id=__codelineno-49-9 name=__codelineno-49-9 href=#__codelineno-49-9></a>
<a id=__codelineno-49-10 name=__codelineno-49-10 href=#__codelineno-49-10></a><span class=c1># Step 2: Specify custom states to override automatic pH-based assignment</span>
<a id=__codelineno-49-11 name=__codelineno-49-11 href=#__codelineno-49-11></a><span class=n>custom_states</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-49-12 name=__codelineno-49-12 href=#__codelineno-49-12></a>    <span class=s2>&quot;ASP12_A&quot;</span><span class=p>:</span> <span class=s2>&quot;ASH&quot;</span><span class=p>,</span>  <span class=c1># Force protonated aspartate in chain A</span>
<a id=__codelineno-49-13 name=__codelineno-49-13 href=#__codelineno-49-13></a>    <span class=s2>&quot;HIS15_A&quot;</span><span class=p>:</span> <span class=s2>&quot;HID&quot;</span><span class=p>,</span>  <span class=c1># Force delta-protonated histidine (instead of HIE or HIP)</span>
<a id=__codelineno-49-14 name=__codelineno-49-14 href=#__codelineno-49-14></a>    <span class=s2>&quot;GLU22&quot;</span><span class=p>:</span> <span class=s2>&quot;GLH&quot;</span>     <span class=c1># Force protonated in all chains</span>
<a id=__codelineno-49-15 name=__codelineno-49-15 href=#__codelineno-49-15></a><span class=p>}</span>
<a id=__codelineno-49-16 name=__codelineno-49-16 href=#__codelineno-49-16></a>
<a id=__codelineno-49-17 name=__codelineno-49-17 href=#__codelineno-49-17></a><span class=c1># Step 3: Apply protonation with custom overrides</span>
<a id=__codelineno-49-18 name=__codelineno-49-18 href=#__codelineno-49-18></a><span class=n>stats</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>apply_protonation_states</span><span class=p>(</span>
<a id=__codelineno-49-19 name=__codelineno-49-19 href=#__codelineno-49-19></a>    <span class=n>input_pdb</span><span class=o>=</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-49-20 name=__codelineno-49-20 href=#__codelineno-49-20></a>    <span class=n>output_pdb</span><span class=o>=</span><span class=s2>&quot;output/protein_custom.pdb&quot;</span><span class=p>,</span>
<a id=__codelineno-49-21 name=__codelineno-49-21 href=#__codelineno-49-21></a>    <span class=n>ph</span><span class=o>=</span><span class=mf>7.4</span><span class=p>,</span>
<a id=__codelineno-49-22 name=__codelineno-49-22 href=#__codelineno-49-22></a>    <span class=n>custom_states</span><span class=o>=</span><span class=n>custom_states</span><span class=p>,</span>
<a id=__codelineno-49-23 name=__codelineno-49-23 href=#__codelineno-49-23></a>    <span class=n>residues</span><span class=o>=</span><span class=n>residues</span>
<a id=__codelineno-49-24 name=__codelineno-49-24 href=#__codelineno-49-24></a><span class=p>)</span>
<a id=__codelineno-49-25 name=__codelineno-49-25 href=#__codelineno-49-25></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Modified </span><span class=si>{</span><span class=n>stats</span><span class=p>[</span><span class=s1>&#39;residue_changes&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> residues (</span><span class=si>{</span><span class=n>stats</span><span class=p>[</span><span class=s1>&#39;record_changes&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> atoms)&quot;</span><span class=p>)</span>
<a id=__codelineno-49-26 name=__codelineno-49-26 href=#__codelineno-49-26></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  Custom states applied: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>custom_states</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-49-27 name=__codelineno-49-27 href=#__codelineno-49-27></a>
<a id=__codelineno-49-28 name=__codelineno-49-28 href=#__codelineno-49-28></a><span class=c1># Step 4: Verify the changes</span>
<a id=__codelineno-49-29 name=__codelineno-49-29 href=#__codelineno-49-29></a><span class=k>for</span> <span class=n>spec</span><span class=p>,</span> <span class=n>state</span> <span class=ow>in</span> <span class=n>custom_states</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<a id=__codelineno-49-30 name=__codelineno-49-30 href=#__codelineno-49-30></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  </span><span class=si>{</span><span class=n>spec</span><span class=si>}</span><span class=s2> → </span><span class=si>{</span><span class=n>state</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div> <p><strong>Example Output:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a>✓ Analyzed 13 ionizable residues
<a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a>✓ Modified 3 residues (44 atoms)
<a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a>  Custom states applied: 3
<a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a>  ASP12_A → ASH
<a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a>  HIS15_A → HID
<a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a>  GLU22 → GLH
</code></pre></div></p> <p><strong>Use Cases:</strong></p> <ul> <li>Force specific protonation for catalytic residues</li> <li>Match experimental conditions or known structures</li> <li>Test different protonation hypotheses</li> <li>Override PROPKA predictions based on domain knowledge</li> </ul> <hr> <h3 id=filtering-and-analysis>Filtering and Analysis<a class=headerlink href=#filtering-and-analysis title="Permanent link">&para;</a></h3> <p>Identify residues with unusual pKa shifts that may indicate important interactions:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=kn>from</span><span class=w> </span><span class=nn>gatewizard.core.propka</span><span class=w> </span><span class=kn>import</span> <span class=n>PropkaAnalyzer</span>
<a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a>
<a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class=c1># Step 1: Run Propka analysis</span>
<a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a><span class=n>analyzer</span> <span class=o>=</span> <span class=n>PropkaAnalyzer</span><span class=p>()</span>
<a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a><span class=n>pka_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>run_analysis</span><span class=p>(</span><span class=s2>&quot;protein.pdb&quot;</span><span class=p>,</span> <span class=n>output_dir</span><span class=o>=</span><span class=s2>&quot;output&quot;</span><span class=p>)</span>
<a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a><span class=n>summary_file</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>extract_summary</span><span class=p>(</span><span class=n>pka_file</span><span class=p>,</span> <span class=n>output_dir</span><span class=o>=</span><span class=s2>&quot;output&quot;</span><span class=p>)</span>
<a id=__codelineno-51-7 name=__codelineno-51-7 href=#__codelineno-51-7></a><span class=n>residues</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>parse_summary</span><span class=p>(</span><span class=n>summary_file</span><span class=p>)</span>
<a id=__codelineno-51-8 name=__codelineno-51-8 href=#__codelineno-51-8></a>
<a id=__codelineno-51-9 name=__codelineno-51-9 href=#__codelineno-51-9></a><span class=c1># Step 2: Define expected model pKa values</span>
<a id=__codelineno-51-10 name=__codelineno-51-10 href=#__codelineno-51-10></a><span class=c1># NOTE: These are typical model pKa values for reference only.</span>
<a id=__codelineno-51-11 name=__codelineno-51-11 href=#__codelineno-51-11></a><span class=c1># For reliable interpretation, use validated reference values appropriate for your system</span>
<a id=__codelineno-51-12 name=__codelineno-51-12 href=#__codelineno-51-12></a><span class=c1># (e.g., from experimental data, literature, or established databases like PROPKA&#39;s model values)</span>
<a id=__codelineno-51-13 name=__codelineno-51-13 href=#__codelineno-51-13></a><span class=n>expected_pka</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-51-14 name=__codelineno-51-14 href=#__codelineno-51-14></a>    <span class=s1>&#39;ASP&#39;</span><span class=p>:</span> <span class=mf>3.9</span><span class=p>,</span> <span class=s1>&#39;GLU&#39;</span><span class=p>:</span> <span class=mf>4.3</span><span class=p>,</span> <span class=s1>&#39;HIS&#39;</span><span class=p>:</span> <span class=mf>6.0</span><span class=p>,</span>
<a id=__codelineno-51-15 name=__codelineno-51-15 href=#__codelineno-51-15></a>    <span class=s1>&#39;LYS&#39;</span><span class=p>:</span> <span class=mf>10.5</span><span class=p>,</span> <span class=s1>&#39;ARG&#39;</span><span class=p>:</span> <span class=mf>12.5</span><span class=p>,</span> <span class=s1>&#39;CYS&#39;</span><span class=p>:</span> <span class=mf>8.3</span><span class=p>,</span> <span class=s1>&#39;TYR&#39;</span><span class=p>:</span> <span class=mf>10.1</span>
<a id=__codelineno-51-16 name=__codelineno-51-16 href=#__codelineno-51-16></a><span class=p>}</span>
<a id=__codelineno-51-17 name=__codelineno-51-17 href=#__codelineno-51-17></a>
<a id=__codelineno-51-18 name=__codelineno-51-18 href=#__codelineno-51-18></a><span class=c1># Step 3: Find residues with significant pKa shifts (&gt;1.0 units)</span>
<a id=__codelineno-51-19 name=__codelineno-51-19 href=#__codelineno-51-19></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Residues with unusual pKa shifts (&gt;1.0 units):&quot;</span><span class=p>)</span>
<a id=__codelineno-51-20 name=__codelineno-51-20 href=#__codelineno-51-20></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;=&quot;</span> <span class=o>*</span> <span class=mi>70</span><span class=p>)</span>
<a id=__codelineno-51-21 name=__codelineno-51-21 href=#__codelineno-51-21></a>
<a id=__codelineno-51-22 name=__codelineno-51-22 href=#__codelineno-51-22></a><span class=n>shifted_residues</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-51-23 name=__codelineno-51-23 href=#__codelineno-51-23></a><span class=k>for</span> <span class=n>res</span> <span class=ow>in</span> <span class=n>residues</span><span class=p>:</span>
<a id=__codelineno-51-24 name=__codelineno-51-24 href=#__codelineno-51-24></a>    <span class=c1># Only analyze protein residues (skip ligands)</span>
<a id=__codelineno-51-25 name=__codelineno-51-25 href=#__codelineno-51-25></a>    <span class=k>if</span> <span class=n>res</span><span class=p>[</span><span class=s1>&#39;res_id&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
<a id=__codelineno-51-26 name=__codelineno-51-26 href=#__codelineno-51-26></a>        <span class=k>continue</span>
<a id=__codelineno-51-27 name=__codelineno-51-27 href=#__codelineno-51-27></a>
<a id=__codelineno-51-28 name=__codelineno-51-28 href=#__codelineno-51-28></a>    <span class=n>res_name</span> <span class=o>=</span> <span class=n>res</span><span class=p>[</span><span class=s1>&#39;residue&#39;</span><span class=p>]</span>
<a id=__codelineno-51-29 name=__codelineno-51-29 href=#__codelineno-51-29></a>    <span class=k>if</span> <span class=n>res_name</span> <span class=ow>in</span> <span class=n>expected_pka</span><span class=p>:</span>
<a id=__codelineno-51-30 name=__codelineno-51-30 href=#__codelineno-51-30></a>        <span class=n>pka_diff</span> <span class=o>=</span> <span class=nb>abs</span><span class=p>(</span><span class=n>res</span><span class=p>[</span><span class=s1>&#39;pka&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=n>expected_pka</span><span class=p>[</span><span class=n>res_name</span><span class=p>])</span>
<a id=__codelineno-51-31 name=__codelineno-51-31 href=#__codelineno-51-31></a>        <span class=k>if</span> <span class=n>pka_diff</span> <span class=o>&gt;</span> <span class=mf>1.0</span><span class=p>:</span>
<a id=__codelineno-51-32 name=__codelineno-51-32 href=#__codelineno-51-32></a>            <span class=n>shifted_residues</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
<a id=__codelineno-51-33 name=__codelineno-51-33 href=#__codelineno-51-33></a>                <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>res_name</span><span class=si>}{</span><span class=n>res</span><span class=p>[</span><span class=s1>&#39;res_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>res</span><span class=p>[</span><span class=s1>&#39;chain&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-51-34 name=__codelineno-51-34 href=#__codelineno-51-34></a>                <span class=s1>&#39;type&#39;</span><span class=p>:</span> <span class=n>res_name</span><span class=p>,</span>
<a id=__codelineno-51-35 name=__codelineno-51-35 href=#__codelineno-51-35></a>                <span class=s1>&#39;pka&#39;</span><span class=p>:</span> <span class=n>res</span><span class=p>[</span><span class=s1>&#39;pka&#39;</span><span class=p>],</span>
<a id=__codelineno-51-36 name=__codelineno-51-36 href=#__codelineno-51-36></a>                <span class=s1>&#39;expected&#39;</span><span class=p>:</span> <span class=n>expected_pka</span><span class=p>[</span><span class=n>res_name</span><span class=p>],</span>
<a id=__codelineno-51-37 name=__codelineno-51-37 href=#__codelineno-51-37></a>                <span class=s1>&#39;shift&#39;</span><span class=p>:</span> <span class=n>res</span><span class=p>[</span><span class=s1>&#39;pka&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=n>expected_pka</span><span class=p>[</span><span class=n>res_name</span><span class=p>]</span>
<a id=__codelineno-51-38 name=__codelineno-51-38 href=#__codelineno-51-38></a>            <span class=p>})</span>
<a id=__codelineno-51-39 name=__codelineno-51-39 href=#__codelineno-51-39></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>res_name</span><span class=si>}{</span><span class=n>res</span><span class=p>[</span><span class=s1>&#39;res_id&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>3d</span><span class=si>}</span><span class=s2> (Chain </span><span class=si>{</span><span class=n>res</span><span class=p>[</span><span class=s1>&#39;chain&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>): &quot;</span>
<a id=__codelineno-51-40 name=__codelineno-51-40 href=#__codelineno-51-40></a>                  <span class=sa>f</span><span class=s2>&quot;pKa=</span><span class=si>{</span><span class=n>res</span><span class=p>[</span><span class=s1>&#39;pka&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>5.2f</span><span class=si>}</span><span class=s2> (expected ~</span><span class=si>{</span><span class=n>expected_pka</span><span class=p>[</span><span class=n>res_name</span><span class=p>]</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>, &quot;</span>
<a id=__codelineno-51-41 name=__codelineno-51-41 href=#__codelineno-51-41></a>                  <span class=sa>f</span><span class=s2>&quot;shift=</span><span class=si>{</span><span class=n>res</span><span class=p>[</span><span class=s1>&#39;pka&#39;</span><span class=p>]</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>expected_pka</span><span class=p>[</span><span class=n>res_name</span><span class=p>]</span><span class=si>:</span><span class=s2>+.1f</span><span class=si>}</span><span class=s2>)&quot;</span><span class=p>)</span>
<a id=__codelineno-51-42 name=__codelineno-51-42 href=#__codelineno-51-42></a>
<a id=__codelineno-51-43 name=__codelineno-51-43 href=#__codelineno-51-43></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>Summary: Found </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>shifted_residues</span><span class=p>)</span><span class=si>}</span><span class=s2> residues with significant pKa shifts&quot;</span><span class=p>)</span>
<a id=__codelineno-51-44 name=__codelineno-51-44 href=#__codelineno-51-44></a>
<a id=__codelineno-51-45 name=__codelineno-51-45 href=#__codelineno-51-45></a><span class=c1># Step 4: Categorize by shift direction</span>
<a id=__codelineno-51-46 name=__codelineno-51-46 href=#__codelineno-51-46></a><span class=n>upshifted</span> <span class=o>=</span> <span class=p>[</span><span class=n>r</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>shifted_residues</span> <span class=k>if</span> <span class=n>r</span><span class=p>[</span><span class=s1>&#39;shift&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mf>1.0</span><span class=p>]</span>
<a id=__codelineno-51-47 name=__codelineno-51-47 href=#__codelineno-51-47></a><span class=n>downshifted</span> <span class=o>=</span> <span class=p>[</span><span class=n>r</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>shifted_residues</span> <span class=k>if</span> <span class=n>r</span><span class=p>[</span><span class=s1>&#39;shift&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=o>-</span><span class=mf>1.0</span><span class=p>]</span>
<a id=__codelineno-51-48 name=__codelineno-51-48 href=#__codelineno-51-48></a>
<a id=__codelineno-51-49 name=__codelineno-51-49 href=#__codelineno-51-49></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  Upshifted (more basic): </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>upshifted</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-51-50 name=__codelineno-51-50 href=#__codelineno-51-50></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  Downshifted (more acidic): </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>downshifted</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-51-51 name=__codelineno-51-51 href=#__codelineno-51-51></a>
<a id=__codelineno-51-52 name=__codelineno-51-52 href=#__codelineno-51-52></a><span class=c1># Step 5: Find extreme cases (&gt;2.0 units shift)</span>
<a id=__codelineno-51-53 name=__codelineno-51-53 href=#__codelineno-51-53></a><span class=n>extreme_shifts</span> <span class=o>=</span> <span class=p>[</span><span class=n>r</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>shifted_residues</span> <span class=k>if</span> <span class=nb>abs</span><span class=p>(</span><span class=n>r</span><span class=p>[</span><span class=s1>&#39;shift&#39;</span><span class=p>])</span> <span class=o>&gt;</span> <span class=mf>2.0</span><span class=p>]</span>
<a id=__codelineno-51-54 name=__codelineno-51-54 href=#__codelineno-51-54></a><span class=k>if</span> <span class=n>extreme_shifts</span><span class=p>:</span>
<a id=__codelineno-51-55 name=__codelineno-51-55 href=#__codelineno-51-55></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>⚠ Extreme shifts (&gt;2.0 units): </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>extreme_shifts</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-51-56 name=__codelineno-51-56 href=#__codelineno-51-56></a>    <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>extreme_shifts</span><span class=p>:</span>
<a id=__codelineno-51-57 name=__codelineno-51-57 href=#__codelineno-51-57></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  </span><span class=si>{</span><span class=n>r</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>r</span><span class=p>[</span><span class=s1>&#39;shift&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>+.2f</span><span class=si>}</span><span class=s2> units&quot;</span><span class=p>)</span>
</code></pre></div> <p><strong>Example Output:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a>Residues with unusual pKa shifts (&gt;1.0 units):
<a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a>======================================================================
<a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a>ASP 42 (Chain A): pKa= 6.23 (expected ~3.9, shift=+2.3)
<a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a>GLU 58 (Chain A): pKa= 2.15 (expected ~4.3, shift=-2.2)
<a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a>HIS 77 (Chain A): pKa= 8.45 (expected ~6.0, shift=+2.5)
<a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a>LYS115 (Chain A): pKa= 8.32 (expected ~10.5, shift=-2.2)
<a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a>CYS128 (Chain A): pKa=10.87 (expected ~8.3, shift=+2.6)
<a id=__codelineno-52-8 name=__codelineno-52-8 href=#__codelineno-52-8></a>
<a id=__codelineno-52-9 name=__codelineno-52-9 href=#__codelineno-52-9></a>Summary: Found 5 residues with significant pKa shifts
<a id=__codelineno-52-10 name=__codelineno-52-10 href=#__codelineno-52-10></a>  Upshifted (more basic): 3
<a id=__codelineno-52-11 name=__codelineno-52-11 href=#__codelineno-52-11></a>  Downshifted (more acidic): 2
<a id=__codelineno-52-12 name=__codelineno-52-12 href=#__codelineno-52-12></a>
<a id=__codelineno-52-13 name=__codelineno-52-13 href=#__codelineno-52-13></a>⚠ Extreme shifts (&gt;2.0 units): 5
<a id=__codelineno-52-14 name=__codelineno-52-14 href=#__codelineno-52-14></a>  ASP42_A: +2.33 units
<a id=__codelineno-52-15 name=__codelineno-52-15 href=#__codelineno-52-15></a>  GLU58_A: -2.15 units
<a id=__codelineno-52-16 name=__codelineno-52-16 href=#__codelineno-52-16></a>  HIS77_A: +2.45 units
<a id=__codelineno-52-17 name=__codelineno-52-17 href=#__codelineno-52-17></a>  LYS115_A: -2.18 units
<a id=__codelineno-52-18 name=__codelineno-52-18 href=#__codelineno-52-18></a>  CYS128_A: +2.57 units
</code></pre></div></p> <p><strong>Interpretation:</strong></p> <ul> <li><strong>Large upshifts</strong> (more basic): May indicate buried residues, salt bridges, or hydrogen bonding networks</li> <li><strong>Large downshifts</strong> (more acidic): May indicate proximity to positive charges or unusual electrostatic environments</li> <li><strong>Extreme shifts (&gt;2 units)</strong>: Often mark functionally important residues like active sites, binding pockets, or structural switches</li> </ul> <hr> <h2 id=important-notes>Important Notes<a class=headerlink href=#important-notes title="Permanent link">&para;</a></h2> <h3 id=output-directory-behavior>Output Directory Behavior<a class=headerlink href=#output-directory-behavior title="Permanent link">&para;</a></h3> <p>⚠️ <strong>Important</strong>: When using <code>output_dir</code>, the code automatically:</p> <ul> <li>Creates the directory if it doesn't exist</li> <li>Converts input file paths to absolute paths</li> <li>Places all output files in the specified directory</li> </ul> <h3 id=pdb-records-vs-residues>PDB Records vs Residues<a class=headerlink href=#pdb-records-vs-residues title="Permanent link">&para;</a></h3> <p>⚠️ <strong>Important distinction</strong>:</p> <ul> <li><strong>Residue changes</strong>: Number of unique residues modified</li> <li><strong>PDB record changes</strong>: Number of ATOM/HETATM lines modified</li> </ul> <p>Example: Changing 1 histidine residue with 10 atoms:</p> <ul> <li><code>residue_changes</code> = 1</li> <li><code>record_changes</code> = 10</li> </ul> <h3 id=dictionary-key-names>Dictionary Key Names<a class=headerlink href=#dictionary-key-names title="Permanent link">&para;</a></h3> <p>⚠️ <strong>Common Mistake</strong>: The parsed residues use these exact key names:</p> <ul> <li>✓ Correct: <code>res['residue']</code> (not <code>res['residue_name']</code>)</li> <li>✓ Correct: <code>res['res_id']</code> (not <code>res['residue_number']</code>)</li> <li>✓ Correct: <code>res['chain']</code> (not <code>res['chain_id']</code>)</li> <li>✓ Correct: <code>res['atom']</code> (atom name for ligands, empty for protein residues)</li> <li>✓ Correct: <code>res['atom_type']</code> (atom type classification like 'N31', 'OCO', 'OP')</li> </ul> <p><strong>Note on Ligands:</strong></p> <ul> <li>Protein residues have <code>res_id &gt; 0</code>, <code>atom == ''</code>, <code>atom_type == ''</code></li> <li>Ligand atoms have <code>res_id == 0</code>, <code>atom</code> contains atom name, <code>atom_type</code> contains classification</li> <li>Use <code>res_id</code> to distinguish: <code>if res['res_id'] &gt; 0:</code> → protein, else → ligand</li> </ul> <h3 id=output-files>Output Files<a class=headerlink href=#output-files title="Permanent link">&para;</a></h3> <p>The analysis generates several files: - <code>*.pka</code> - Full Propka output - <code>*_summary_of_prediction.txt</code> - Extracted summary section - <code>*_protonated.pdb</code> - After applying protonation states - <code>*_ss.pdb</code> - After applying disulfide bonds - <code>*_gatewizard_residue_mapping.txt</code> - Residue mapping (if capping used)</p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2025 Constanza González, Mauricio Bedoya </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/maurobedoya/gatewizard target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.top", "navigation.tracking", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy", "toc.follow"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.e71a0d61.min.js></script> <script src=../../javascripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>